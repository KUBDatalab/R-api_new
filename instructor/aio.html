<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en" data-bs-theme="auto">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<title>APIs with R: All in One View</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="../assets/themetoggle.js"></script><link rel="stylesheet" type="text/css" href="../assets/styles.css">
<script src="../assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="manifest" href="../site.webmanifest">
<link rel="mask-icon" href="../safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="white">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="black">
</head>
<body>
    <header id="top" class="navbar navbar-expand-md top-nav library"><svg xmlns="http://www.w3.org/2000/svg" class="d-none"><symbol id="check2" viewbox="0 0 16 16"><path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"></path></symbol><symbol id="circle-half" viewbox="0 0 16 16"><path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"></path></symbol><symbol id="moon-stars-fill" viewbox="0 0 16 16"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"></path><path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"></path></symbol><symbol id="sun-fill" viewbox="0 0 16 16"><path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"></path></symbol></svg><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-8">
      <div class="large-logo">
        <img id="lc-logo" alt="Library Carpentry" src="../assets/images/library-logo.svg"><span class="badge text-bg-info">
          <abbr title="This lesson is in the beta phase, which means that it is ready for teaching by instructors outside of the original author team.">
            <a href="https://cdh.carpentries.org/the-lesson-life-cycle.html#polishing-beta-stage" class="external-link alert-link">
              <i aria-hidden="true" class="icon" data-feather="alert-circle" style="border-radius: 5px"></i>
              Beta
            </a>
            <span class="visually-hidden">This lesson is in the beta phase, which means that it is ready for teaching by instructors outside of the original author team.</span>
          </abbr>
        </span>

      </div>
    </div>
    <div class="selector-container">
      <div id="theme-selector">
        <li class="nav-item dropdown" id="theme-button-list">
          <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
            <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme-text">
<li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                Light
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                Dark
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                Auto
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
          </ul>
</li>
      </div>

      <div class="dropdown" id="instructor-dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
<li><button class="dropdown-item" type="button" onclick="window.location.href='../aio.html';">Learner View</button></li>
        </ul>
</div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl bottom-nav library" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Library Carpentry" src="../assets/images/library-logo-sm.svg">
</div>
    <div class="lesson-title-md">
      APIs with R
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="Search the All In One page" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
<li class="nav-item">
          <span class="lesson-title">
            APIs with R
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/instructor-notes.html">Instructor Notes</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/images.html">Extract All Images</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
<hr>
<li><a class="dropdown-item" href="reference.html">Reference</a></li>
          </ul>
</li>
      </ul>
</div>
    <!--
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
      <input class="form-control me-2 searchbox" type="search" placeholder="" aria-label="">
        <button class="btn btn-outline-success tablet-search-button"  type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="Search the All In One page"></i>
        </button>
      </fieldset>
    </form>
    -->
    <a id="search-button" class="btn btn-primary" href="../instructor/aio.html" role="button" aria-label="Search the All In One page">Search the All In One page</a>
  </div>
<!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  APIs with R
</div>

<aside class="col-md-12 lesson-progress"><div style="width: %" class="percentage">
    %
  </div>
  <div class="progress library">
    <div class="progress-bar library" role="progressbar" style="width: %" aria-valuenow="" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row" id="theme-row-mobile">
            <div class="col" id="theme-selector">
              <li class="nav-item dropdown" id="theme-button-list">
                <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
                  <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><span class="d-lg-none ms-1" id="bd-theme-text">Toggle Theme</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="bd-theme-text">
<li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                      Light
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                      Dark
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                      <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                      Auto
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                </ul>
</li>
            </div>
          </div>
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="../aio.html">Learner View</a>
                      </div>
                    </div>
                  </div>
<!--/div.accordion-item-->
                </div>
<!--/div.accordion-flush-->
              </div>
<!--div.sidenav-view-selector -->
            </div>
<!--/div.col -->

            <hr>
</div>
<!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Schedule</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="api-in-general.html">1. What is an API?</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="getting-data.html">2. GETting data</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="post-statistics-denmark.html">3. Using POST</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="danstat.html">4. What about danstat?</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush6">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading6">
        <a href="note-on-time.html">5. A short note on time</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush7">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading7">
        <a href="ggplot2.html">6. ggplot2</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush8">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading8">
        <a href="whats-next.html">7. Whats next?</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width">
<div class="accordion accordion-flush lesson-resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="lesson-resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul>
<li>
                        <a href="../instructor/key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="../instructor/instructor-notes.html">Instructor Notes</a>
                      </li>
                      <li>
                        <a href="../instructor/images.html">Extract All Images</a>
                      </li>
                      <hr>
<li><a class="dropdown-item" href="reference.html">Reference</a></li>
                    </ul>
</div>
                </div>
              </div>
            </div>
            <hr class="half-width lesson-resources">
<a href="../instructor/aio.html">See all in one page</a>


            <hr class="d-none d-sm-block d-md-none">
<div class="d-grid gap-1">

            </div>
          </div>
<!-- /div.accordion -->
        </div>
<!-- /div.sidebar-inner -->
      </nav>
</div>
<!-- /div.sidebar -->
  </div>
<!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-extra.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <main id="main-content" class="main-content"><div class="container lesson-content">
        
        
<section id="aio-api-in-general"><p>Content from <a href="api-in-general.html">What is an API?</a></p>
<hr>
<p>Last updated on 2024-08-27 |

        <a href="https://github.com/KUBDatalab/R-api_new/edit/main/episodes/api-in-general.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 12 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>What is an API?</li>
<li>How do our computer interact with servers?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Understand what an API do</li>
<li>Get to know the two main ways to get data from APIs</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="what-is-an-api">What is an API?<a class="anchor" aria-label="anchor" href="#what-is-an-api"></a>
</h2>
<hr class="half-width">
<p>An API is an Application Programming Interface. It is a way of making
applications, in our case an R-script, able to communicate with another
application typically an online database.</p>
<p>What we want to be able to do, is to let our own application, our
R-script, send a command to a remote application, an online database, in
order to retrieve specific data.</p>
<p>And we want to read the answer we get in return.</p>
<p>This is equivalent to requesting a page from a webserver, something
we have all done.</p>
<p>Webservers and browsers communicate using the HTTP protocol, and the
mechanics of this communication can be visualized like this:</p>
<figure><img src="../fig/http-structure.png" alt="Structure of what is happening behind the scenes when we request a webpage" class="figure mx-auto d-block"><div class="figcaption">Structure of what is happening behind the scenes
when we request a webpage</div>
</figure><ul>
<li><p>When we type in an URL in our browser, it translates that URL to
a HTTP-request.</p></li>
<li><p>The browser sends that HTTP-request to a webserver. The request
contains information about the page we need, but in the “header” of the
request, there is a lot of other information. The version of browser we
are using and cookies, to just mention two. The most important might be
information about what type of response we would like.</p></li>
<li><p>The webserver interpret the request, and retrieves the
data.</p></li>
<li><p>After that, the webserver sends both the status of the request
(hopefully 200 - which is short for “everything is OK”), and the
data.</p></li>
<li><p>The browser receives the data, and displays it as a
webpage.</p></li>
</ul>
<p>When we are working with APIs we cut out the user. We have a script
that needs some data. We write code that defines, and then send a
request til a server, specifying which data we need. The server extracts
the needed data, and returns it to the script.</p>
</section><section><h2 class="section-heading" id="so---how-do-we-do-that">So - how do we do that?<a class="anchor" aria-label="anchor" href="#so---how-do-we-do-that"></a>
</h2>
<hr class="half-width">
<p>Looking closer at the illustration above, we can see that we send a
request to the server. That request contains several parts.</p>
<p><em>The request line.</em> That contains the method we are using to
communicate with the server, the adress and path of the server, and the
information about the version of HTTP we are using to communicate with
the server.</p>
<p><em>The header.</em> Headers are meta information about our request.
It contains information about who we are, the type of browser we are
using and much more.</p>
<p><em>The body.</em> This is really the message that we are sending to
the server. Where the request line tells our computer where to we are
sending our request, and the header provides information about the
request, the body is the actual message we are sending to the
server.</p>
<p>The trick is now to make the API understand what data we would like
to get back from it.</p>
</section><section><h2 class="section-heading" id="two-types-of-requests">Two types of requests<a class="anchor" aria-label="anchor" href="#two-types-of-requests"></a>
</h2>
<hr class="half-width">
<p>Two main types of requests are used when communicating with APIs, and
they primarily concerns how we tell the API what data we would like.</p>
<p>In a <em>GET</em> request, we encode what we would like returned in
the URL. You probably know that way already.</p>
<p>The URL “<a href="https://icanhazdadjoke.com/search?term=dog" class="external-link uri">https://icanhazdadjoke.com/search?term=dog</a>” is asking
the server to search for the term “dog”. What we are searching for, is
placed directly in the URL.</p>
<p>What we are sending to the server looks like this:</p>
<figure><img src="../fig/GET-headers.png" alt="Content of a GET header" class="figure mx-auto d-block"><div class="figcaption">Content of a GET header</div>
</figure><p>In a <em>POST</em> request, that information is stored in the body of
the request.</p>
<p>That looks like this:</p>
<figure><img src="../fig/POST-headers.png" alt="Contents of a POST header" class="figure mx-auto d-block"><div class="figcaption">Contents of a POST header</div>
</figure><p>Note that the main difference between these two sets of headers,
besides the difference in GET and POST, is that there is a <em>body</em>
in the POST version. This is where the actual search is placed, rather
than in the URL.</p>
<p>Almost all APIs support one or both of these methods.</p>
<p>The GET method is intuitively easy to understand, and it is
relatively easy to edit the URL to search for something else. On the
other hand there are limitations to what we can search for. Everything
must be text, and there are limitations on the length of the search as
well.</p>
<p>The POST method allow us to search for arbitrarily many parameters,
and can handle many different data types - because we can put almost any
kind of data into the body part of the request. The POST method is also
more secure, because the body can be encrypted during transport from our
computer to the server. This is also the method we need to use should
the API require a login.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Getting data from an API is equivalent to requesting a webpage</li>
<li>GET requests specify what data we want to retrieve in the URL</li>
<li>POST requests specify what data we want to retrieve in the body of
the request.</li>
<li>Both requests have headers that we can manipulate to get what we
want.</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-getting-data"><p>Content from <a href="getting-data.html">GETting data</a></p>
<hr>
<p>Last updated on 2024-08-27 |

        <a href="https://github.com/KUBDatalab/R-api_new/edit/main/episodes/getting-data.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 12 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How do I get data from an API using the GET method?</li>
<li>Is there a way to modify headers, to get a specific type of
result?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Learn how to retrieve data using the GET method</li>
<li>Learn how to adjust headers to get desired result</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>Please note: These pages are autogenerated. Some of the API-calls may
fail during that process. We are figuring out what to do about it, but
please excuse us for any red errors on the pages for the time being.</p>
<section><h2 class="section-heading" id="using-get">Using GET<a class="anchor" aria-label="anchor" href="#using-get"></a>
</h2>
<hr class="half-width">
<p>The site icanhazdadjoke.com offers a wide selection of dad-jokes.</p>
<div id="dad-jokes" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="dad-jokes" class="callout-inner">
<h3 class="callout-title">Dad jokes</h3>
<div class="callout-content">
<p>a wholesome joke of the type said to be told by fathers with a
punchline that is often an obvious or predictable pun or play on words
and usually judged to be endearingly corny or unfunny <a href="https://www.merriam-webster.com/dictionary/dad%20joke" class="external-link uri">https://www.merriam-webster.com/dictionary/dad%20joke</a></p>
</div>
</div>
</div>
<p>In addition to the website, an API is available that can be accessed
using the GET method.</p>
<p>The GET method is a generic procedure, we need a function that
actually handles the behind-the-scenes-stuff for us. The library
<em>httr</em> have an implementation:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">httr</span><span class="op">)</span></span></code></pre>
</div>
<p>Taking a quick look at the <a href="https://icanhazdadjoke.com/api" class="external-link">documentation</a> we first try GET
directly:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">GET</span><span class="op">(</span><span class="st">"https://icanhazdadjoke.com/"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Response [https://icanhazdadjoke.com/]
  Date: 2024-08-27 01:48
  Status: 200
  Content-Type: text/html; charset=utf-8
  Size: 9.79 kB
&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
&lt;head&gt;
&lt;meta charset="utf-8"&gt;
&lt;meta http-equiv="X-UA-Compatible" content="IE=edge"&gt;
&lt;meta name="viewport" content="width=device-width, initial-scale=1, minimum-s...
&lt;meta name="description" content="The largest collection of dad jokes on the ...
&lt;meta name="author" content="C653 Labs" /&gt;
&lt;meta name="keywords" content="dad,joke,funny,slack,alexa" /&gt;
&lt;meta property="og:site_name" content="icanhazdadjoke" /&gt;
...</code></pre>
</div>
<p>What is returned is the response from the server. That includes much
more than what we are looking for. Notable is the “Status” part, which
we are told is “200”, which is server-lingo for “everything is OK”.</p>
<p>And what do we get? We get a webpage. We can see that the content is
<em>DOCTYPE html</em>. That was not really what we were looking for.
HTML is not that easy to work with, and contains a lot of extranious
information that we do not need.</p>
<p>Even if the GET method is relatively simple to work with, we need to
add a bit more. Again taking a look at the documentation, it appears
that we need to tell the API, that we would like a specific type of
response, rather than the default html, more specifically
“text/plain”.</p>
<p><em>httr</em> has helper functions to assist us. The one we need here
is <em>accept()</em> We now use that to tell the server, that we really
want a response in just text:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">GET</span><span class="op">(</span><span class="st">"https://icanhazdadjoke.com/"</span>, <span class="fu">accept</span><span class="op">(</span><span class="st">"text/plain"</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="va">result</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Response [https://icanhazdadjoke.com/]
  Date: 2024-08-27 01:48
  Status: 200
  Content-Type: text/plain
  Size: 285 B
A panda walks into a bar and says to the bartender “I’ll have a Scotch and . ...

“Sure thing” the bartender replies and asks “but what’s with the big pause?”
</code></pre>
</div>
<p>We still get the response from the server, telling us that Status is
200, and everything is OK. But where is our dad-joke?</p>
<p>It is hidden in the content of the response. It is sent to us as
binary code, so we are using the <em>content()</em> function, also from
<em>httr</em> to extract it:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">content</span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>No encoding supplied: defaulting to UTF-8.</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "A panda walks into a bar and says to the bartender “I’ll have a Scotch and . . . . . . . . . . . . . . Coke thank you”. \r\n\r\n“Sure thing” the bartender replies and asks “but what’s with the big pause?” \r\n\r\nThe panda holds up his hands and says “I was born with them”"</code></pre>
</div>
<p>There is a little warning about the encoding of the string. But now
we have a dad-joke!</p>
<p>What if we need to retrieve a specific joke? All the jokes has an ID,
that we can use for that. If we want to find that, we need a bit more
information about the joke. We can get that by specifying that we would
like the result of our GET-request returned as JSON.</p>
<div id="json" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="json" class="callout-inner">
<h3 class="callout-title">JSON</h3>
<div class="callout-content">
<p>JSON (JavaScript Object Notation) is a format for structuring, in
principle, any kind for text, structured in almost any way. It consists
of pairs of strings, one denoting the name of the data we are looking
at, and one containing the content of that data. Each set of data fields
are encapsulated in curly braces, and a data field can have subfields,
also encapsulated in curly braces. It can look like this:</p>
<p>{ “firstName”: “John”, “lastName”: “Smith”, “phoneNumbers”:{ “type”:
“home”, “number”: “212 555-1234” }, { “type”: “office”, “number”: “646
555-4567” } }</p>
<p>JSON is readable for both humans and computers, but can be a bit
tricky to convert to dataframes if there are a lot of nested fields.</p>
</div>
</div>
</div>
<p>Looking at the documentation, we see an example, which indicates that
what we should tell the server that we accept, should be
“application/json”. The <em>httr</em> library contains helper functions
to assist us in manipulating the header. We use <em>accept()</em> that
sets the <em>accept</em> part of the header:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">GET</span><span class="op">(</span><span class="st">"https://icanhazdadjoke.com/"</span>, <span class="fu">accept</span><span class="op">(</span><span class="st">"application/json"</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="va">result</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Response [https://icanhazdadjoke.com/]
  Date: 2024-08-27 01:48
  Status: 200
  Content-Type: application/json
  Size: 114 B
{"id":"JBIBImbMe","joke":"Did you hear the one about the giant pickle?  He wa...</code></pre>
</div>
<p>Again - everything is nice and 200 = OK.</p>
<p>We also see a truncated version of the actual joke.</p>
<p>Let us use the content() function to extract the content:</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">content</span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>$id
[1] "JBIBImbMe"

$joke
[1] "Did you hear the one about the giant pickle?  He was kind of a big dill."

$status
[1] 200</code></pre>
</div>
<p>This data is returned as a list, which is the R-default way of
handling any kind of data. Status is repeated, and now we have an id. We
can use that to extract the same joke again.</p>
<p>NOTE: The joke returned is chosen at random. The id used here will
probably be different from what we found above.</p>
<p>The way to retrieve a specific joke is to GET the URL:</p>
<p><code>GET https://icanhazdadjoke.com/j/&lt;joke_id&gt;</code></p>
<p>Where we replace the <em>joke_id</em> with the specific joke we want.
Remember to specify the result that we want:</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">tidyverse</span><span class="op">)</span></span>
<span><span class="fu">GET</span><span class="op">(</span><span class="st">"https://icanhazdadjoke.com/j/lGJmrrzAsc"</span>,  <span class="fu">accept</span><span class="op">(</span><span class="st">"text/plain"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">content</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>No encoding supplied: defaulting to UTF-8.</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "A termite walks into a bar and asks “Is the bar tender here?”"</code></pre>
</div>
<p>We can also search for words in jokes. The documentation tells us,
that we should send our GET request to the URL</p>
<p><a href="https://icanhazdadjoke.com/search" class="external-link uri">https://icanhazdadjoke.com/search</a></p>
<p>And in the examples we get the hint, that we should format the URL
as:</p>
<p><a href="https://icanhazdadjoke.com/search?term=" class="external-link uri">https://icanhazdadjoke.com/search?term=</a><term></term></p>
<p>Dogs are always fun, let us search for dad jokes about dogs. Specify
the type of result we want, pipe the response to the content() function
and save it to <em>result</em>:</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">GET</span><span class="op">(</span><span class="st">"https://icanhazdadjoke.com/search?term=dog"</span>,</span>
<span>              <span class="fu">accept</span><span class="op">(</span><span class="st">"application/json"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>          <span class="fu">content</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">result</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>$current_page
[1] 1

$limit
[1] 20

$next_page
[1] 1

$previous_page
[1] 1

$results
$results[[1]]
$results[[1]]$id
[1] "82wHlbaapzd"

$results[[1]]$joke
[1] "Me: If humans lose the ability to hear high frequency volumes as they get older, can my 4 week old son hear a dog whistle?\r\n\r\nDoctor: No, humans can never hear that high of a frequency no matter what age they are.\r\n\r\nMe: Trick question... dogs can't whistle."


$results[[2]]
$results[[2]]$id
[1] "YvkV8xXnjyd"

$results[[2]]$joke
[1] "Why did the cowboy have a weiner dog? Somebody told him to get a long little doggy."


$results[[3]]
$results[[3]]$id
[1] "lyk3EIBQfxc"

$results[[3]]$joke
[1] "I went to the zoo the other day, there was only one dog in it. It was a shitzu."


$results[[4]]
$results[[4]]$id
[1] "DIeaUDlbUDd"

$results[[4]]$joke
[1] "“My Dog has no nose.” “How does he smell?” “Awful”"


$results[[5]]
$results[[5]]$id
[1] "EBQfiyXD5ob"

$results[[5]]$joke
[1] "what do you call a dog that can do magic tricks? a labracadabrador"


$results[[6]]
$results[[6]]$id
[1] "GtH6E6UD5Ed"

$results[[6]]$joke
[1] "What kind of dog lives in a particle accelerator? A Fermilabrador Retriever."


$results[[7]]
$results[[7]]$id
[1] "obhFBljb2g"

$results[[7]]$joke
[1] "I adopted my dog from a blacksmith. As soon as we got home he made a bolt for the door."


$results[[8]]
$results[[8]]$id
[1] "89MZLmWnWvc"

$results[[8]]$joke
[1] "I can't take my dog to the pond anymore because the ducks keep attacking him. That's what I get for buying a pure bread dog."


$results[[9]]
$results[[9]]$id
[1] "R7UfaahVfFd"

$results[[9]]$joke
[1] "My dog used to chase people on a bike a lot. It got so bad I had to take his bike away."


$results[[10]]
$results[[10]]$id
[1] "71wsPKeF6h"

$results[[10]]$joke
[1] "What did the dog say to the two trees? Bark bark."


$results[[11]]
$results[[11]]$id
[1] "sPRnOfiyAAd"

$results[[11]]$joke
[1] "At the boxing match, the dad got into the popcorn line and the line for hot dogs, but he wanted to stay out of the punchline."


$results[[12]]
$results[[12]]$id
[1] "AQn3wPKeqrc"

$results[[12]]$joke
[1] "It was raining cats and dogs the other day. I almost stepped in a poodle."


$results[[13]]
$results[[13]]$id
[1] "Lmjqzsr49pb"

$results[[13]]$joke
[1] "What did the Zen Buddist say to the hotdog vendor? Make me one with everything."



$search_term
[1] "dog"

$status
[1] 200

$total_jokes
[1] 13

$total_pages
[1] 1</code></pre>
</div>
<p>This is in JSON format. It is clear that the jokes are in the
$results part of that datastructure. How can we get that to a data
frame?</p>
<p>the content() function can treat the content of our response in
different ways. If we treat it as text, the function fromJSON from the
library <em>jsonlite</em>, can convert it to a data frame. We begin by
loading the library:</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">jsonlite</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>
Attaching package: 'jsonlite'</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>The following object is masked from 'package:purrr':

    flatten</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">GET</span><span class="op">(</span><span class="st">"https://icanhazdadjoke.com/search?term=dog"</span>, <span class="fu">accept</span><span class="op">(</span><span class="st">"application/json"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">content</span><span class="op">(</span>as<span class="op">=</span><span class="st">"text"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">fromJSON</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>No encoding supplied: defaulting to UTF-8.</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>$current_page
[1] 1

$limit
[1] 20

$next_page
[1] 1

$previous_page
[1] 1

$results
            id
1  YvkV8xXnjyd
2  82wHlbaapzd
3   obhFBljb2g
4  89MZLmWnWvc
5  GtH6E6UD5Ed
6  R7UfaahVfFd
7   71wsPKeF6h
8  lyk3EIBQfxc
9  DIeaUDlbUDd
10 EBQfiyXD5ob
11 AQn3wPKeqrc
12 sPRnOfiyAAd
13 Lmjqzsr49pb
                                                                                                                                                                                                                                                                         joke
1                                                                                                                                                                                         Why did the cowboy have a weiner dog? Somebody told him to get a long little doggy.
2  Me: If humans lose the ability to hear high frequency volumes as they get older, can my 4 week old son hear a dog whistle?\r\n\r\nDoctor: No, humans can never hear that high of a frequency no matter what age they are.\r\n\r\nMe: Trick question... dogs can't whistle.
3                                                                                                                                                                                     I adopted my dog from a blacksmith. As soon as we got home he made a bolt for the door.
4                                                                                                                                                I can't take my dog to the pond anymore because the ducks keep attacking him. That's what I get for buying a pure bread dog.
5                                                                                                                                                                                                What kind of dog lives in a particle accelerator? A Fermilabrador Retriever.
6                                                                                                                                                                                     My dog used to chase people on a bike a lot. It got so bad I had to take his bike away.
7                                                                                                                                                                                                                           What did the dog say to the two trees? Bark bark.
8                                                                                                                                                                                             I went to the zoo the other day, there was only one dog in it. It was a shitzu.
9                                                                                                                                                                                                                          “My Dog has no nose.” “How does he smell?” “Awful”
10                                                                                                                                                                                                         what do you call a dog that can do magic tricks? a labracadabrador
11                                                                                                                                                                                                  It was raining cats and dogs the other day. I almost stepped in a poodle.
12                                                                                                                                              At the boxing match, the dad got into the popcorn line and the line for hot dogs, but he wanted to stay out of the punchline.
13                                                                                                                                                                                            What did the Zen Buddist say to the hotdog vendor? Make me one with everything.

$search_term
[1] "dog"

$status
[1] 200

$total_jokes
[1] 13

$total_pages
[1] 1</code></pre>
</div>
<p>We have now seen how to send a request to an API, with search terms
embedded in the URL.</p>
<p>We have seen how to add an argument to the GET function, that
specifies the type of result we would like, effectively by adding
something to the header of our request.</p>
<p>And we have seen how to extract the results, and get them into a
dataframe.</p>
<p>Next, we are going to take a look on how we get results using the
POST method, on an API that provides more factual and serious, but not
so funny data.</p>
<div id="exercise" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="exercise" class="callout-inner">
<h3 class="callout-title">Exercise</h3>
<div class="callout-content">
<p>Request dad jokes about cats</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">GET</span><span class="op">(</span><span class="st">"https://icanhazdadjoke.com/search?term=dog"</span>, <span class="fu">accept</span><span class="op">(</span><span class="st">"application/json"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span><span class="fu">content</span><span class="op">(</span>as<span class="op">=</span><span class="st">"text"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span><span class="fu">fromJSON</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>No encoding supplied: defaulting to UTF-8.</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>$current_page
[1] 1

$limit
[1] 20

$next_page
[1] 1

$previous_page
[1] 1

$results
            id
1  YvkV8xXnjyd
2  82wHlbaapzd
3  lyk3EIBQfxc
4  DIeaUDlbUDd
5  EBQfiyXD5ob
6  GtH6E6UD5Ed
7   obhFBljb2g
8  89MZLmWnWvc
9   71wsPKeF6h
10 R7UfaahVfFd
11 AQn3wPKeqrc
12 sPRnOfiyAAd
13 Lmjqzsr49pb
                                                                                                                                                                                                                                                                         joke
1                                                                                                                                                                                         Why did the cowboy have a weiner dog? Somebody told him to get a long little doggy.
2  Me: If humans lose the ability to hear high frequency volumes as they get older, can my 4 week old son hear a dog whistle?\r\n\r\nDoctor: No, humans can never hear that high of a frequency no matter what age they are.\r\n\r\nMe: Trick question... dogs can't whistle.
3                                                                                                                                                                                             I went to the zoo the other day, there was only one dog in it. It was a shitzu.
4                                                                                                                                                                                                                          “My Dog has no nose.” “How does he smell?” “Awful”
5                                                                                                                                                                                                          what do you call a dog that can do magic tricks? a labracadabrador
6                                                                                                                                                                                                What kind of dog lives in a particle accelerator? A Fermilabrador Retriever.
7                                                                                                                                                                                     I adopted my dog from a blacksmith. As soon as we got home he made a bolt for the door.
8                                                                                                                                                I can't take my dog to the pond anymore because the ducks keep attacking him. That's what I get for buying a pure bread dog.
9                                                                                                                                                                                                                           What did the dog say to the two trees? Bark bark.
10                                                                                                                                                                                    My dog used to chase people on a bike a lot. It got so bad I had to take his bike away.
11                                                                                                                                                                                                  It was raining cats and dogs the other day. I almost stepped in a poodle.
12                                                                                                                                              At the boxing match, the dad got into the popcorn line and the line for hot dogs, but he wanted to stay out of the punchline.
13                                                                                                                                                                                            What did the Zen Buddist say to the hotdog vendor? Make me one with everything.

$search_term
[1] "dog"

$status
[1] 200

$total_jokes
[1] 13

$total_pages
[1] 1</code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>200 is the internet code for everything is OK</li>
<li>GET requests can be adjusted to specify desired result</li>
<li>Dad jokes are not really that good.</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-post-statistics-denmark"><p>Content from <a href="post-statistics-denmark.html">Using POST</a></p>
<hr>
<p>Last updated on 2024-08-27 |

        <a href="https://github.com/KUBDatalab/R-api_new/edit/main/episodes/post-statistics-denmark.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 45 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>“How do I get data from an API using the POST method?”</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>“Connect to Statistics Denmark, and extract data”</li>
<li>“Create a list of lists to control the variables to be
extracted”</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>Please note: These pages are autogenerated. Some of the API-calls may
fail during that process. We are figuring out what to do about it, but
please excuse us for any red errors on the pages for the time being.</p>
<section><h2 class="section-heading" id="getting-data-from-statistics-denmark">Getting data from Statistics Denmark<a class="anchor" aria-label="anchor" href="#getting-data-from-statistics-denmark"></a>
</h2>
<hr class="half-width">
<p>The API from statistics Denmark can accept GET requests. But they
recommend using POST instead. That allows us to do more advanced
searches for data easier.</p>
<p>We are going to write a POST-request (with a little help from R), to
retrieve data from Statistics Denmark.</p>
<p>But before we can do that, we need to know how the SD-API expects to
receive data.</p>
<p>Hopefully we can get that by reading the [documentation, that can be
found here.]<a href="https://www.dst.dk/en/Statistik/brug-statistikken/muligheder-i-statistikbanken/api" class="external-link uri">https://www.dst.dk/en/Statistik/brug-statistikken/muligheder-i-statistikbanken/api</a></p>
<p>But that is rather confusing.</p>
<p>The main points:</p>
<p>First: Statistics Denmark provides four “functions”, or
<em>endpoints</em>. This is equivalent to the URL we requested data from
using the GET method.</p>
<p><img src="../fig/DSfunctions.png" alt="“functions or endpoints at the API" class="figure">{Screenshot of endpoints at
Statistics Denmark API}</p>
<ul>
<li>The first is the “web”-site we have to send requests to if we want
information on the subjects in Statistics Denmark.</li>
<li>In the second we get information about which tables are available
for a given subject.</li>
<li>The third will provide metadata on a table.</li>
<li>When we finally need the data, we will visit the last endpoint.</li>
</ul>
<p>Secondly: We need to provide a body containing search parameters in a
format like this:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">{</span></span>
<span>   <span class="st">"table"</span><span class="op">:</span> <span class="st">"folk1c"</span></span>
<span><span class="op">}</span></span></code></pre>
</div>
<p>Let us look at how to do this, by sending a request to
<code>subjects</code>.</p>
<p>The endpoint was</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">endpoint</span> <span class="op">&lt;-</span> <span class="st">"http://api.statbank.dk/v1/subjects"</span></span></code></pre>
</div>
<p>We will now need to construct a named list for the content of the
body that we send along with our request.</p>
<p>This is a new datastructure that we have not encountered before.</p>
<p>Vectors are annoying because they can only contain one datatype. And
dataframes must be rectangular.</p>
<p>A list allows us to store basically anything. The reason that we do
not use them for everything is that they are a bit more difficult to
work with.</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">our_body</span> <span class="op">&lt;-</span> <span class="fu">list</span><span class="op">(</span>lang <span class="op">=</span> <span class="st">"en"</span>, recursive <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>                  includeTables <span class="op">=</span> <span class="cn">FALSE</span>, subjects <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre>
</div>
<p>This list contains four elements, with names. - The first,
<code>lang</code>, contains a character vector (length 1), containing
“en”, the language that we want Statistics Denmark to use when returning
data. - <code>recursive</code> and <code>includeTables</code> are
logical values, both false. - <code>subjects</code> is a special value,
NULL. This is not a missing value, there simply isn’t anything there.
But this nothing does have a name.</p>
<div id="lists" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="lists" class="callout-inner">
<h3 class="callout-title">lists</h3>
<div class="callout-content">
<p>Lists are subset in a special way. If we want the first element in
<code>our_body</code>, we can use the usual bracket notation:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">our_body</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>$lang
[1] "en"</code></pre>
</div>
<p>If we want the actual value of element 1, we use a double bracket
notation:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">our_body</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "en"</code></pre>
</div>
</div>
</div>
</div>
<p>Now we have the two things we need, an endpoint to send a request,
and a body containing what we want returned.</p>
<p>Let us try it:</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">httr</span><span class="fu">::</span><span class="fu">POST</span><span class="op">(</span><span class="va">endpoint</span>, body<span class="op">=</span><span class="va">our_body</span>, encode <span class="op">=</span> <span class="st">"json"</span><span class="op">)</span></span></code></pre>
</div>
<p>We ask to get the result in json, a speciel datastructure that is
able to contain almost anything.</p>
<p>Let us look at the result:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Response [https://api.statbank.dk/v1/subjects]
  Date: 2024-08-27 01:48
  Status: 200
  Content-Type: text/json; charset=utf-8
  Size: 884 B</code></pre>
</div>
<p>Both informative. And utterly useless. The informative information is
that our request succeeded (cave - it might not succeed on this
webpage). We can see that in the status. 200 is an internet code for
success.</p>
<p>Let us get the content of the result, which is what we actually
want:</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">content</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "[{\"id\":\"1\",\"description\":\"People\",\"active\":true,\"hasSubjects\":true,\"subjects\":[]},{\"id\":\"2\",\"description\":\"Labour and income\",\"active\":true,\"hasSubjects\":true,\"subjects\":[]},{\"id\":\"3\",\"description\":\"Economy\",\"active\":true,\"hasSubjects\":true,\"subjects\":[]},{\"id\":\"4\",\"description\":\"Social conditions\",\"active\":true,\"hasSubjects\":true,\"subjects\":[]},{\"id\":\"5\",\"description\":\"Education and research\",\"active\":true,\"hasSubjects\":true,\"subjects\":[]},{\"id\":\"6\",\"description\":\"Business\",\"active\":true,\"hasSubjects\":true,\"subjects\":[]},{\"id\":\"7\",\"description\":\"Transport\",\"active\":true,\"hasSubjects\":true,\"subjects\":[]},{\"id\":\"8\",\"description\":\"Culture and leisure\",\"active\":true,\"hasSubjects\":true,\"subjects\":[]},{\"id\":\"9\",\"description\":\"Environment and energy\",\"active\":true,\"hasSubjects\":true,\"subjects\":[]},{\"id\":\"19\",\"description\":\"Other\",\"active\":true,\"hasSubjects\":true,\"subjects\":[]}]"</code></pre>
</div>
<p>More informative, but not really easy to read.</p>
<p>The library <code>jsonlite</code> has a function that converts this
to something readable:</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">content</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">fromJSON</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>   id            description active hasSubjects subjects
1   1                 People   TRUE        TRUE     NULL
2   2      Labour and income   TRUE        TRUE     NULL
3   3                Economy   TRUE        TRUE     NULL
4   4      Social conditions   TRUE        TRUE     NULL
5   5 Education and research   TRUE        TRUE     NULL
6   6               Business   TRUE        TRUE     NULL
7   7              Transport   TRUE        TRUE     NULL
8   8    Culture and leisure   TRUE        TRUE     NULL
9   9 Environment and energy   TRUE        TRUE     NULL
10 19                  Other   TRUE        TRUE     NULL</code></pre>
</div>
<p>A nice dataframe with the ten major subjects in the databases of
Statistics Denmark.</p>
<p>Subject 1 contains information about populations and elections.</p>
<p>There are sub-subjects under that. We can see that in the column
<code>hasSubjects</code></p>
<p>We now modify our body that we send with the request, to return
information about the first subject.</p>
<p>We need to make sure that the number of the subject, <code>1</code>
is intepreted as it is. This is a little bit of mysterious handwaving -
we simply put the 1 inside the function <code>I()</code> and stuff
works.</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">our_body</span> <span class="op">&lt;-</span> <span class="fu">list</span><span class="op">(</span>lang <span class="op">=</span> <span class="st">"en"</span>, recursive <span class="op">=</span> <span class="cn">F</span>, </span>
<span>                  includeTables <span class="op">=</span> <span class="cn">F</span>, subjects <span class="op">=</span> <span class="fu">I</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div id="i" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="i" class="callout-inner">
<h3 class="callout-title">I()</h3>
<div class="callout-content">
<p>I() isolates - or insulates - the contents of I() from the gaze of
R’s parsing code. Basically it prevents R from doing stuff to the
content that we dont want it to. In this specific case, the POST()
function would convert the vector 1, with length 1, to a scalar, the
more basic data type in R, that hold only one, single, atomic value at a
time.</p>
</div>
</div>
</div>
<p>Note that it is important that we tell the POST function that the
body is the body:</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">POST</span><span class="op">(</span><span class="va">endpoint</span>, body<span class="op">=</span><span class="va">our_body</span>, encode <span class="op">=</span> <span class="st">"json"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">content</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">fromJSON</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  id description active hasSubjects
1  1      People   TRUE        TRUE
                                                                                                                                                                                                                                                      subjects
1 3401, 3407, 3410, 3415, 3412, 3411, 3428, 3409, Population, Households, families and children, Migration, Housing, Health, Democracy, National church, Names, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE</code></pre>
</div>
<p>Not that easy to see in this format, but the data frame contains a
data frame. That is, in the column <code>subjects</code> the content is
a data frame.</p>
<p>We pick that out using the $-notation:</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span><span class="op">$</span><span class="va">subjects</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[[1]]
    id                       description active hasSubjects subjects
1 3401                        Population   TRUE        TRUE     NULL
2 3407 Households, families and children   TRUE        TRUE     NULL
3 3410                         Migration   TRUE        TRUE     NULL
4 3415                           Housing   TRUE        TRUE     NULL
5 3412                            Health   TRUE        TRUE     NULL
6 3411                         Democracy   TRUE        TRUE     NULL
7 3428                   National church   TRUE        TRUE     NULL
8 3409                             Names   TRUE        TRUE     NULL</code></pre>
</div>
<p>These are the sub-subjects of subject 1.</p>
<p>Let us look closer at 3401, Population.</p>
<p>Again, we modify the call we send to the endpoint:</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">our_body</span> <span class="op">&lt;-</span> <span class="fu">list</span><span class="op">(</span>lang <span class="op">=</span> <span class="st">"en"</span>, recursive <span class="op">=</span> <span class="cn">F</span>, </span>
<span>                  includeTables <span class="op">=</span> <span class="cn">F</span>, subjects <span class="op">=</span> <span class="fu">I</span><span class="op">(</span><span class="fl">3401</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">POST</span><span class="op">(</span><span class="va">endpoint</span>, body<span class="op">=</span><span class="va">our_body</span>, encode <span class="op">=</span> <span class="st">"json"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">content</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">fromJSON</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>    id description active hasSubjects
1 3401  Population   TRUE        TRUE
                                                                                                                                                                                                                                                                                              subjects
1 20021, 20024, 20022, 20019, 20017, 20018, 20014, 20015, Population figures, Immigrants and their descendants, Population projections, Adoptions, Births, Fertility, Deaths, Life expectancy, TRUE, TRUE, TRUE, FALSE, TRUE, TRUE, TRUE, TRUE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE</code></pre>
</div>
<p>We delve deeper into it:</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span><span class="op">$</span><span class="va">subjects</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[[1]]
     id                      description active hasSubjects subjects
1 20021               Population figures   TRUE       FALSE     NULL
2 20024 Immigrants and their descendants   TRUE       FALSE     NULL
3 20022           Population projections   TRUE       FALSE     NULL
4 20019                        Adoptions  FALSE       FALSE     NULL
5 20017                           Births   TRUE       FALSE     NULL
6 20018                        Fertility   TRUE       FALSE     NULL
7 20014                           Deaths   TRUE       FALSE     NULL
8 20015                  Life expectancy   TRUE       FALSE     NULL</code></pre>
</div>
<p>And now we are at the bottom. 20021 Population figures does not have
any sub-sub-subjects.</p>
<p>Next, let us take a look at the tables contained under subject
20021.</p>
<p>We need the next endpoint, which provides information about tables
under a subject:</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">endpoint</span> <span class="op">&lt;-</span> <span class="st">"http://api.statbank.dk/v1/tables"</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">our_body</span> <span class="op">&lt;-</span> <span class="fu">list</span><span class="op">(</span>lang <span class="op">=</span> <span class="st">"en"</span>, subjects <span class="op">=</span> <span class="fu">I</span><span class="op">(</span><span class="fl">20021</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">POST</span><span class="op">(</span><span class="va">endpoint</span>, body<span class="op">=</span><span class="va">our_body</span>, encode <span class="op">=</span> <span class="st">"json"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">content</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">fromJSON</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">data</span> <span class="op">%&gt;%</span> <span class="fu">head</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>        id                                       text   unit
1   FOLK1A Population at the first day of the quarter Number
2  FOLK1AM   Population at the first day of the month Number
3  BEFOLK1                      Population 1. January Number
4  BEFOLK2                      Population 1. January Number
5    FOLK3                      Population 1. January Number
6 FOLK3FOD                      Population 1. January Number
              updated firstPeriod latestPeriod active
1 2024-08-12T08:00:00      2008Q1       2024Q3   TRUE
2 2024-08-12T08:00:00     2021M10      2024M07   TRUE
3 2024-02-12T08:00:00        1971         2024   TRUE
4 2024-02-12T08:00:00        1901         2024   TRUE
5 2024-02-12T08:00:00        2008         2024   TRUE
6 2024-02-12T08:00:00        2008         2024   TRUE
                                          variables
1            region, sex, age, marital status, time
2                            region, sex, age, time
3                    sex, age, marital status, time
4                                    sex, age, time
5    day of birth, birth month, year of birth, time
6 day of birth, birth month, country of birth, time</code></pre>
</div>
<p>There are 21 tables under this subject. Let us see what information
we can get about table “FOLK1A”:</p>
<p>We now need the third endpoint:</p>
<div class="codewrapper sourceCode" id="cb28">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">endpoint</span> <span class="op">&lt;-</span> <span class="st">"http://api.statbank.dk/v1/tableinfo"</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">our_body</span> <span class="op">&lt;-</span> <span class="fu">list</span><span class="op">(</span>lang <span class="op">=</span> <span class="st">"en"</span>, table <span class="op">=</span> <span class="st">"FOLK1A"</span><span class="op">)</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">POST</span><span class="op">(</span><span class="va">endpoint</span>, body<span class="op">=</span><span class="va">our_body</span>, encode <span class="op">=</span> <span class="st">"json"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">content</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">fromJSON</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">data</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>$id
[1] "FOLK1A"

$text
[1] "Population at the first day of the quarter"

$description
[1] "Population at the first day of the quarter by region, sex, age, marital status and time"

$unit
[1] "Number"

$suppressedDataValue
[1] "0"

$updated
[1] "2024-08-12T08:00:00"

$active
[1] TRUE

$contacts
           name    phone       mail
1 Dorthe Larsen 39173307 dla@dst.dk

$documentation
$documentation$id
[1] "4a12721d-a8b0-4bde-82d7-1d1c6f319de3"

$documentation$url
[1] "https://www.dst.dk/documentationofstatistics/4a12721d-a8b0-4bde-82d7-1d1c6f319de3"


$footnote
NULL

$variables
          id           text elimination  time                     map
1     OMRÅDE         region        TRUE FALSE denmark_municipality_07
2        KØN            sex        TRUE FALSE                    &lt;NA&gt;
3      ALDER            age        TRUE FALSE                    &lt;NA&gt;
4 CIVILSTAND marital status        TRUE FALSE                    &lt;NA&gt;
5        Tid           time       FALSE  TRUE                    &lt;NA&gt;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               values
1                                                                                                                                                                                           000, 084, 101, 147, 155, 185, 165, 151, 153, 157, 159, 161, 163, 167, 169, 183, 173, 175, 187, 201, 240, 210, 250, 190, 270, 260, 217, 219, 223, 230, 400, 411, 085, 253, 259, 350, 265, 269, 320, 376, 316, 326, 360, 370, 306, 329, 330, 340, 336, 390, 083, 420, 430, 440, 482, 410, 480, 450, 461, 479, 492, 530, 561, 563, 607, 510, 621, 540, 550, 573, 575, 630, 580, 082, 710, 766, 615, 707, 727, 730, 741, 740, 746, 706, 751, 657, 661, 756, 665, 760, 779, 671, 791, 081, 810, 813, 860, 849, 825, 846, 773, 840, 787, 820, 851, All Denmark, Region Hovedstaden, Copenhagen, Frederiksberg, Dragør, Tårnby, Albertslund, Ballerup, Brøndby, Gentofte, Gladsaxe, Glostrup, Herlev, Hvidovre, Høje-Taastrup, Ishøj, Lyngby-Taarbæk, Rødovre, Vallensbæk, Allerød, Egedal, Fredensborg, Frederikssund, Furesø, Gribskov, Halsnæs, Helsingør, Hillerød, Hørsholm, Rudersdal, Bornholm, Christiansø, Region Sjælland, Greve, Køge, Lejre, Roskilde, Solrød, Faxe, Guldborgsund, Holbæk, Kalundborg, Lolland, Næstved, Odsherred, Ringsted, Slagelse, Sorø, Stevns, Vordingborg, Region Syddanmark, Assens, Faaborg-Midtfyn, Kerteminde, Langeland, Middelfart, Nordfyns, Nyborg, Odense, Svendborg, Ærø, Billund, Esbjerg, Fanø, Fredericia, Haderslev, Kolding, Sønderborg, Tønder, Varde, Vejen, Vejle, Aabenraa, Region Midtjylland, Favrskov, Hedensted, Horsens, Norddjurs, Odder, Randers, Samsø, Silkeborg, Skanderborg, Syddjurs, Aarhus, Herning, Holstebro, Ikast-Brande, Lemvig, Ringkøbing-Skjern, Skive, Struer, Viborg, Region Nordjylland, Brønderslev, Frederikshavn, Hjørring, Jammerbugt, Læsø, Mariagerfjord, Morsø, Rebild, Thisted, Vesthimmerlands, Aalborg
2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        TOT, 1, 2, Total, Men, Women
3 IALT, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123, 124, 125, Age, total, 0 years, 1 year, 2 years, 3 years, 4 years, 5 years, 6 years, 7 years, 8 years, 9 years, 10 years, 11 years, 12 years, 13 years, 14 years, 15 years, 16 years, 17 years, 18 years, 19 years, 20 years, 21 years, 22 years, 23 years, 24 years, 25 years, 26 years, 27 years, 28 years, 29 years, 30 years, 31 years, 32 years, 33 years, 34 years, 35 years, 36 years, 37 years, 38 years, 39 years, 40 years, 41 years, 42 years, 43 years, 44 years, 45 years, 46 years, 47 years, 48 years, 49 years, 50 years, 51 years, 52 years, 53 years, 54 years, 55 years, 56 years, 57 years, 58 years, 59 years, 60 years, 61 years, 62 years, 63 years, 64 years, 65 years, 66 years, 67 years, 68 years, 69 years, 70 years, 71 years, 72 years, 73 years, 74 years, 75 years, 76 years, 77 years, 78 years, 79 years, 80 years, 81 years, 82 years, 83 years, 84 years, 85 years, 86 years, 87 years, 88 years, 89 years, 90 years, 91 years, 92 years, 93 years, 94 years, 95 years, 96 years, 97 years, 98 years, 99 years, 100 years, 101 years, 102 years, 103 years, 104 years, 105 years, 106 years, 107 years, 108 years, 109 years, 110 years, 111 years, 112 years, 113 years, 114 years, 115 years, 116 years, 117 years, 118 years, 119 years, 120 years, 121 years, 122 years, 123 years, 124 years, 125 years
4                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         TOT, U, G, E, F, Total, Never married, Married/separated, Widowed, Divorced
5                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      2008K1, 2008K2, 2008K3, 2008K4, 2009K1, 2009K2, 2009K3, 2009K4, 2010K1, 2010K2, 2010K3, 2010K4, 2011K1, 2011K2, 2011K3, 2011K4, 2012K1, 2012K2, 2012K3, 2012K4, 2013K1, 2013K2, 2013K3, 2013K4, 2014K1, 2014K2, 2014K3, 2014K4, 2015K1, 2015K2, 2015K3, 2015K4, 2016K1, 2016K2, 2016K3, 2016K4, 2017K1, 2017K2, 2017K3, 2017K4, 2018K1, 2018K2, 2018K3, 2018K4, 2019K1, 2019K2, 2019K3, 2019K4, 2020K1, 2020K2, 2020K3, 2020K4, 2021K1, 2021K2, 2021K3, 2021K4, 2022K1, 2022K2, 2022K3, 2022K4, 2023K1, 2023K2, 2023K3, 2023K4, 2024K1, 2024K2, 2024K3, 2008Q1, 2008Q2, 2008Q3, 2008Q4, 2009Q1, 2009Q2, 2009Q3, 2009Q4, 2010Q1, 2010Q2, 2010Q3, 2010Q4, 2011Q1, 2011Q2, 2011Q3, 2011Q4, 2012Q1, 2012Q2, 2012Q3, 2012Q4, 2013Q1, 2013Q2, 2013Q3, 2013Q4, 2014Q1, 2014Q2, 2014Q3, 2014Q4, 2015Q1, 2015Q2, 2015Q3, 2015Q4, 2016Q1, 2016Q2, 2016Q3, 2016Q4, 2017Q1, 2017Q2, 2017Q3, 2017Q4, 2018Q1, 2018Q2, 2018Q3, 2018Q4, 2019Q1, 2019Q2, 2019Q3, 2019Q4, 2020Q1, 2020Q2, 2020Q3, 2020Q4, 2021Q1, 2021Q2, 2021Q3, 2021Q4, 2022Q1, 2022Q2, 2022Q3, 2022Q4, 2023Q1, 2023Q2, 2023Q3, 2023Q4, 2024Q1, 2024Q2, 2024Q3</code></pre>
</div>
<p>This is a bit more complicated. We are told that:</p>
<ol style="list-style-type: decimal">
<li><p>there are five columns in this table.</p></li>
<li><p>They each have an id</p></li>
<li><p>And a descriptive text</p></li>
<li><p>Elimination means that the API will attempt to eliminate the
variables we have not chosen values for when data is returned. This
makes sense when we get to point 7.</p></li>
<li><p>time - only one of the variables contain information about a
point in time.</p></li>
<li><p>One of the variables can be mapped to - well a map</p></li>
<li><p>The final column provides information about which values are
stored in the variable. There are 105 different regions in Denmark. And
if we do not choose a specific region - the API will attempt to
eliminate this facetting, and return data for all of Denmark.</p></li>
</ol>
<p>These data provides useful information for constructing the final
call to the API in order to get the data.</p>
<p>We will now need the final endpoint:</p>
<div class="codewrapper sourceCode" id="cb31">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">endpoint</span> <span class="op">&lt;-</span> <span class="st">"http://api.statbank.dk/v1/data"</span></span></code></pre>
</div>
<p>And we will need to specify which information, from which table, we
want data in the body of the request. That is a bit more complicated. We
need to make a list of lists!</p>
<div class="codewrapper sourceCode" id="cb32">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">variables</span> <span class="op">&lt;-</span> <span class="fu">list</span><span class="op">(</span><span class="fu">list</span><span class="op">(</span>code <span class="op">=</span> <span class="st">"OMRÅDE"</span>, values <span class="op">=</span> <span class="fu">I</span><span class="op">(</span><span class="st">"*"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                  <span class="fu">list</span><span class="op">(</span>code <span class="op">=</span> <span class="st">"CIVILSTAND"</span>, values <span class="op">=</span> <span class="fu">I</span><span class="op">(</span><span class="fu">c</span><span class="op">(</span><span class="st">"U"</span>, <span class="st">"G"</span>, <span class="st">"E"</span>, <span class="st">"F"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                  <span class="fu">list</span><span class="op">(</span>code <span class="op">=</span> <span class="st">"Tid"</span>, values <span class="op">=</span> <span class="fu">I</span><span class="op">(</span><span class="st">"*"</span><span class="op">)</span><span class="op">)</span></span>
<span>              <span class="op">)</span></span>
<span></span>
<span><span class="va">our_body</span> <span class="op">&lt;-</span> <span class="fu">list</span><span class="op">(</span>table <span class="op">=</span> <span class="st">"FOLK1A"</span>, lang <span class="op">=</span> <span class="st">"en"</span>, format <span class="op">=</span> <span class="st">"CSV"</span>, variables <span class="op">=</span> <span class="va">variables</span><span class="op">)</span></span></code></pre>
</div>
<p>The final call boils down to:</p>
<div class="codewrapper sourceCode" id="cb33">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">POST</span><span class="op">(</span><span class="va">endpoint</span>, body<span class="op">=</span><span class="va">our_body</span>, encode <span class="op">=</span> <span class="st">"json"</span><span class="op">)</span></span></code></pre>
</div>
<p>The data is returned as csv - we defined that in “our_body”, so we
now need to extract it a bit differently:</p>
<div class="codewrapper sourceCode" id="cb34">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">content</span><span class="op">(</span>type <span class="op">=</span> <span class="st">"text"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">read_csv2</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>ℹ Using "','" as decimal and "'.'" as grouping mark. Use `read_delim()` for more control.</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>No encoding supplied: defaulting to UTF-8.</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Rows: 28140 Columns: 4
── Column specification ────────────────────────────────────────────────────────
Delimiter: ";"
chr (3): OMRÅDE, CIVILSTAND, TID
dbl (1): INDHOLD

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb38">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 28,140 × 4
   OMRÅDE      CIVILSTAND    TID    INDHOLD
   &lt;chr&gt;       &lt;chr&gt;         &lt;chr&gt;    &lt;dbl&gt;
 1 All Denmark Never married 2008Q1 2552700
 2 All Denmark Never married 2008Q2 2563134
 3 All Denmark Never married 2008Q3 2564705
 4 All Denmark Never married 2008Q4 2568255
 5 All Denmark Never married 2009Q1 2575185
 6 All Denmark Never married 2009Q2 2584993
 7 All Denmark Never married 2009Q3 2584560
 8 All Denmark Never married 2009Q4 2588198
 9 All Denmark Never married 2010Q1 2593172
10 All Denmark Never married 2010Q2 2604129
# ℹ 28,130 more rows</code></pre>
</div>
<p>Voila! We have a dataframe with information about how many persons in
Denmark were married (or not) at different points in time.</p>
<p>That was a bit complicated. There are easier ways to do it.</p>
<p>We will look at that shortly. So why do it this way? These techniques
are the same techniques we use when we access an arbitrary other API.
The fields, endpoints etc might be different. We might have an added
complication of having to login to it. But the techniques can be
reused.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>“POST requests to servers put specific demands on how we request
data”</li>
<li>“Using an API requires us to understand (some of) the ways the API
works”</li>
<li>“Different searches typically requires different endpoints”</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-danstat"><p>Content from <a href="danstat.html">What about danstat?</a></p>
<hr>
<p>Last updated on 2024-08-27 |

        <a href="https://github.com/KUBDatalab/R-api_new/edit/main/episodes/danstat.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 12 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>Is there an easier way to access Statistics Denmark</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Use a package to do the API-calls to Statistics Denmark</li>
<li>Connect to Statistics Denmark, and extract data</li>
<li>Create a list of lists to control the variables to be extracted</li>
<li>Using the danstat package</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>Please note: These pages are autogenerated. Some of the API-calls may
fail during that process. We are figuring out what to do about it, but
please excuse us for any red errors on the pages for the time being.</p>
<section><h2 class="section-heading" id="is-there-an-easier-way">Is there an easier way?<a class="anchor" aria-label="anchor" href="#is-there-an-easier-way"></a>
</h2>
<hr class="half-width">
<p>Many larger online services provide packages for easier access to
their APIs.</p>
<p>Popular services might not have to do this, because enthusiasts write
packages themselves.</p>
<p>A package called <code>danstat</code> is available, and makes it
easier to extract data from Statistics Denmark.</p>
</section><section><h2 class="section-heading" id="the-danstat-packagelibrary">The danstat package/library<a class="anchor" aria-label="anchor" href="#the-danstat-packagelibrary"></a>
</h2>
<hr class="half-width">
<p>Previously we retrieved at table with demographic data from
Statistics Denmark.</p>
<p>How can we get that table using the danstat package?</p>
<p>Before using the library, we will need to install it:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">install.packages</span><span class="op">(</span><span class="st">"danstat"</span><span class="op">)</span></span></code></pre>
</div>
<p>Some installations of R may have problems installing it. In that
case, try this:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">install.packages</span><span class="op">(</span><span class="st">"remotes"</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">remotes</span><span class="op">)</span></span>
<span><span class="va">remotes</span><span class="op">:</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"cran/danstat"</span><span class="op">)</span></span></code></pre>
</div>
<p>After installation, we load the library using the library function.
And then we can access the functions included in the library:</p>
<p>The danstat package contain four functions, equivalent to the four
endpoints we discussed earlier.</p>
<p>The get_subjects() function sends a request to the Statistics Denmark
API, asking for a list of the subjects. The information is returned to
our script, and the get_subjects() function presents us with a dataframe
containing the information.</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">danstat</span><span class="op">)</span></span>
<span><span class="va">subjects</span> <span class="op">&lt;-</span> <span class="fu">get_subjects</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">subjects</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>   id            description active hasSubjects subjects
1   1                 People   TRUE        TRUE     NULL
2   2      Labour and income   TRUE        TRUE     NULL
3   3                Economy   TRUE        TRUE     NULL
4   4      Social conditions   TRUE        TRUE     NULL
5   5 Education and research   TRUE        TRUE     NULL
6   6               Business   TRUE        TRUE     NULL
7   7              Transport   TRUE        TRUE     NULL
8   8    Culture and leisure   TRUE        TRUE     NULL
9   9 Environment and energy   TRUE        TRUE     NULL
10 19                  Other   TRUE        TRUE     NULL</code></pre>
</div>
<p>We get the 10 major subjects from Statistics Denmark we have seen
before. As before, each of them have sub-subjects.</p>
<p>If we want to take a closer look at the subdivisions of a given
subject, we use the get_subjects() function again, this time specifying
which subject we are interested in:</p>
<p>Let us try to get the sub-subjects from the subject 1 - containing
information about populations and elections:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sub_subjects</span> <span class="op">&lt;-</span> <span class="fu">get_subjects</span><span class="op">(</span>subjects <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">sub_subjects</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  id description active hasSubjects
1  1      People   TRUE        TRUE
                                                                                                                                                                                                                                                      subjects
1 3401, 3407, 3410, 3415, 3412, 3411, 3428, 3409, Population, Households, families and children, Migration, Housing, Health, Democracy, National church, Names, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE</code></pre>
</div>
<p>The result is a bit complicated. The column “subjects” in the
resulting dataframe contains another dataframe. We access it like we
normally would access a column in a dataframe:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sub_subjects</span><span class="op">$</span><span class="va">subjects</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[[1]]
    id                       description active hasSubjects subjects
1 3401                        Population   TRUE        TRUE     NULL
2 3407 Households, families and children   TRUE        TRUE     NULL
3 3410                         Migration   TRUE        TRUE     NULL
4 3415                           Housing   TRUE        TRUE     NULL
5 3412                            Health   TRUE        TRUE     NULL
6 3411                         Democracy   TRUE        TRUE     NULL
7 3428                   National church   TRUE        TRUE     NULL
8 3409                             Names   TRUE        TRUE     NULL</code></pre>
</div>
<p>Those sub-subjects have their own subjects! Lets get to the bottom of
this, and use 2401, Population and population projections as an
example:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sub_sub_subjects</span> <span class="op">&lt;-</span> <span class="fu">get_subjects</span><span class="op">(</span><span class="st">"3401"</span><span class="op">)</span></span>
<span><span class="va">sub_sub_subjects</span><span class="op">$</span><span class="va">subjects</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[[1]]
     id                      description active hasSubjects subjects
1 20021               Population figures   TRUE       FALSE     NULL
2 20024 Immigrants and their descendants   TRUE       FALSE     NULL
3 20022           Population projections   TRUE       FALSE     NULL
4 20019                        Adoptions  FALSE       FALSE     NULL
5 20017                           Births   TRUE       FALSE     NULL
6 20018                        Fertility   TRUE       FALSE     NULL
7 20014                           Deaths   TRUE       FALSE     NULL
8 20015                  Life expectancy   TRUE       FALSE     NULL</code></pre>
</div>
<p>Now we are at the bottom. We can see in the column “hasSubjects” that
there are no sub_sub_sub_subjects.</p>
<p>The hierarchy is: 1 Population and elections | 3401 Population |
20021 Population figures</p>
<p>The final sub_sub_subject contains a number of tables, that actually
contains the data we are looking for.</p>
<p>get_subjects is able to retrieve all the sub, sub-sub and
sub-sub-sub-jects in one go. The result is a bit confusing and difficult
to navigate.</p>
<p>Remember that the initial result was a dataframe containing another
dataframe. If we go all the way to the bottom, we will get a dataframe,
containing several dataframes, each of those containing several
dataframes.</p>
<p>We recommend that you do not try it, but this is how it is done:</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lots_of_subjects</span> <span class="op">&lt;-</span> <span class="fu">get_subjects</span><span class="op">(</span><span class="fl">1</span>, recursive <span class="op">=</span> <span class="cn">T</span>, include_tables <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code></pre>
</div>
<p>The “recursive = T” parameter means that get_subjects will retrieve
the subjects of the subjects, and then the subjects of those
subjects.</p>
</section><section><h2 class="section-heading" id="which-datatables-exists">Which datatables exists?<a class="anchor" aria-label="anchor" href="#which-datatables-exists"></a>
</h2>
<hr class="half-width">
<p>But we ended up with a sub_sub_subject,</p>
<p><em>20021 Population figures</em></p>
<p>How do we find out which tables exists in this subject?</p>
<p>The get_tables() function returns a dataframe with information about
the tables available for a given subject.</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tables</span> <span class="op">&lt;-</span> <span class="fu">get_tables</span><span class="op">(</span>subjects<span class="op">=</span><span class="st">"20021"</span><span class="op">)</span></span>
<span><span class="va">tables</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>         id
1    FOLK1A
2   FOLK1AM
3   BEFOLK1
4   BEFOLK2
5     FOLK3
6  FOLK3FOD
7      BEF5
8        FT
9     HISB3
10      BY1
11      BY2
12      BY3
13     BEF4
14  POSTNR1
15  POSTNR2
16      KM1
17    SOGN1
18   LABY02
19   LABY03
20   LABY05
21    BEF5F
22    BEF5G
23    BEV22
24 FRGNSK24
25   LABY01
26   BEV107
27 KMSTA003
28   GALDER
29 KMGALDER
                                                                         text
1                                  Population at the first day of the quarter
2                                    Population at the first day of the month
3                                                       Population 1. January
4                                                       Population 1. January
5                                                       Population 1. January
6                                                       Population 1. January
7                                                       Population 1. January
8                                                Population from the censuses
9                                                    Summary vital statistics
10                                                      Population 1. January
11                                                      Population 1. January
12                                                      Population 1. January
13                                                      Population 1. January
14                                                      Population 1. January
15                                                      Population 1. January
16                                 Population at the first day of the quarter
17                                                      Population 1. January
18              Population i percentage of all in the same municipality group
19                             Population i percentage of all in the same age
20 Persons, who lived in the same municipality group as they did 20 years ago
21              People born in Faroe Islands and living in Denmark 1. January
22                  People born in Greenland and living in Denmark 1. January
23                                Summary vital statistics (provisional data)
24                                                   Summary vital statistics
25                                       Population increase per 1,000 capita
26                                                   Summary vital statistics
27                                                   Summary vital statistics
28                                                                Average age
29                                                                Average age
               unit             updated firstPeriod latestPeriod active
1            Number 2024-08-12T08:00:00      2008Q1       2024Q3   TRUE
2            Number 2024-08-12T08:00:00     2021M10      2024M07   TRUE
3            Number 2024-02-12T08:00:00        1971         2024   TRUE
4            Number 2024-02-12T08:00:00        1901         2024   TRUE
5            Number 2024-02-12T08:00:00        2008         2024   TRUE
6            Number 2024-02-12T08:00:00        2008         2024   TRUE
7            Number 2024-02-12T08:00:00        1990         2024   TRUE
8            Number 2024-02-12T08:00:00        1769         2024   TRUE
9            Number 2024-02-12T08:00:00        1901         2024   TRUE
10           Number 2024-05-31T08:00:00        2010         2024   TRUE
11           Number 2024-05-31T08:00:00        2010         2024   TRUE
12                - 2024-06-28T08:00:00        2017         2024   TRUE
13           Number 2024-04-18T08:00:00        1901         2024   TRUE
14           Number 2024-02-12T08:00:00        2010         2024   TRUE
15           Number 2024-02-12T08:00:00        2010         2024   TRUE
16           Number 2024-08-12T08:00:00      2007Q1       2024Q3   TRUE
17           Number 2024-02-12T08:00:00        2010         2024   TRUE
18         Per cent 2024-02-12T08:00:00        2008         2024   TRUE
19         Per cent 2024-02-12T08:00:00        2008         2024   TRUE
20         Per cent 2024-02-12T08:00:00        2007         2024   TRUE
21           Number 2024-02-12T08:00:00        2008         2024   TRUE
22           Number 2024-02-12T08:00:00        2008         2024   TRUE
23           Number 2024-08-12T08:00:00      2007Q2       2024Q2   TRUE
24           Number 2024-06-04T08:00:00        1992         2023   TRUE
25 Per 1,000 capita 2024-02-12T08:00:00        2007         2023   TRUE
26           Number 2024-02-12T08:00:00        2006         2023   TRUE
27           Number 2024-02-12T08:00:00        2015         2023   TRUE
28             Avg. 2024-02-12T08:00:00        2005         2024   TRUE
29             Avg. 2024-02-12T08:00:00        2007         2024   TRUE
                                                             variables
1                               region, sex, age, marital status, time
2                                               region, sex, age, time
3                                       sex, age, marital status, time
4                                                       sex, age, time
5                       day of birth, birth month, year of birth, time
6                    day of birth, birth month, country of birth, time
7                                     sex, age, country of birth, time
8                                                  national part, time
9                                               type of movement, time
10                               urban and rural areas, age, sex, time
11                             municipality, city size, age, sex, time
12 urban and rural areas, population area and population density, time
13                                                       islands, time
14                                         postal code, sex, age, time
15                                         postal code, sex, age, time
16                         parish, member of the National Church, time
17                                              parish, sex, age, time
18                                      municipality groups, age, time
19                                      municipality groups, age, time
20                                      municipality groups, age, time
21                              sex, age, parents place of birth, time
22                              sex, age, parents place of birth, time
23                                 region, type of movement, sex, time
24                                    type of movement, age, sex, time
25                         municipality groups, type of movement, time
26                                 region, type of movement, sex, time
27                                             parish, movements, time
28                                             municipality, sex, time
29                                                   parish, sex, time</code></pre>
</div>
<p>We get at lot of information here. The id identifies the table, text
gives a description of the table that humans can understand. When the
table was last updated and the first and last period that the table
contains data for.</p>
<p>In the variables column, we get information on what kind of data is
stored in the table.</p>
<p>Before we pull out the data, we need to know which variables are
available in the table. We do this with this function:</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">metadata</span> <span class="op">&lt;-</span> <span class="fu">get_table_metadata</span><span class="op">(</span><span class="st">"FOLK1A"</span>, variables_only <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="va">metadata</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>          id           text elimination  time                     map
1     OMRÅDE         region        TRUE FALSE denmark_municipality_07
2        KØN            sex        TRUE FALSE                    &lt;NA&gt;
3      ALDER            age        TRUE FALSE                    &lt;NA&gt;
4 CIVILSTAND marital status        TRUE FALSE                    &lt;NA&gt;
5        Tid           time       FALSE  TRUE                    &lt;NA&gt;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               values
1                                                                                                                                                                                           000, 084, 101, 147, 155, 185, 165, 151, 153, 157, 159, 161, 163, 167, 169, 183, 173, 175, 187, 201, 240, 210, 250, 190, 270, 260, 217, 219, 223, 230, 400, 411, 085, 253, 259, 350, 265, 269, 320, 376, 316, 326, 360, 370, 306, 329, 330, 340, 336, 390, 083, 420, 430, 440, 482, 410, 480, 450, 461, 479, 492, 530, 561, 563, 607, 510, 621, 540, 550, 573, 575, 630, 580, 082, 710, 766, 615, 707, 727, 730, 741, 740, 746, 706, 751, 657, 661, 756, 665, 760, 779, 671, 791, 081, 810, 813, 860, 849, 825, 846, 773, 840, 787, 820, 851, All Denmark, Region Hovedstaden, Copenhagen, Frederiksberg, Dragør, Tårnby, Albertslund, Ballerup, Brøndby, Gentofte, Gladsaxe, Glostrup, Herlev, Hvidovre, Høje-Taastrup, Ishøj, Lyngby-Taarbæk, Rødovre, Vallensbæk, Allerød, Egedal, Fredensborg, Frederikssund, Furesø, Gribskov, Halsnæs, Helsingør, Hillerød, Hørsholm, Rudersdal, Bornholm, Christiansø, Region Sjælland, Greve, Køge, Lejre, Roskilde, Solrød, Faxe, Guldborgsund, Holbæk, Kalundborg, Lolland, Næstved, Odsherred, Ringsted, Slagelse, Sorø, Stevns, Vordingborg, Region Syddanmark, Assens, Faaborg-Midtfyn, Kerteminde, Langeland, Middelfart, Nordfyns, Nyborg, Odense, Svendborg, Ærø, Billund, Esbjerg, Fanø, Fredericia, Haderslev, Kolding, Sønderborg, Tønder, Varde, Vejen, Vejle, Aabenraa, Region Midtjylland, Favrskov, Hedensted, Horsens, Norddjurs, Odder, Randers, Samsø, Silkeborg, Skanderborg, Syddjurs, Aarhus, Herning, Holstebro, Ikast-Brande, Lemvig, Ringkøbing-Skjern, Skive, Struer, Viborg, Region Nordjylland, Brønderslev, Frederikshavn, Hjørring, Jammerbugt, Læsø, Mariagerfjord, Morsø, Rebild, Thisted, Vesthimmerlands, Aalborg
2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        TOT, 1, 2, Total, Men, Women
3 IALT, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123, 124, 125, Age, total, 0 years, 1 year, 2 years, 3 years, 4 years, 5 years, 6 years, 7 years, 8 years, 9 years, 10 years, 11 years, 12 years, 13 years, 14 years, 15 years, 16 years, 17 years, 18 years, 19 years, 20 years, 21 years, 22 years, 23 years, 24 years, 25 years, 26 years, 27 years, 28 years, 29 years, 30 years, 31 years, 32 years, 33 years, 34 years, 35 years, 36 years, 37 years, 38 years, 39 years, 40 years, 41 years, 42 years, 43 years, 44 years, 45 years, 46 years, 47 years, 48 years, 49 years, 50 years, 51 years, 52 years, 53 years, 54 years, 55 years, 56 years, 57 years, 58 years, 59 years, 60 years, 61 years, 62 years, 63 years, 64 years, 65 years, 66 years, 67 years, 68 years, 69 years, 70 years, 71 years, 72 years, 73 years, 74 years, 75 years, 76 years, 77 years, 78 years, 79 years, 80 years, 81 years, 82 years, 83 years, 84 years, 85 years, 86 years, 87 years, 88 years, 89 years, 90 years, 91 years, 92 years, 93 years, 94 years, 95 years, 96 years, 97 years, 98 years, 99 years, 100 years, 101 years, 102 years, 103 years, 104 years, 105 years, 106 years, 107 years, 108 years, 109 years, 110 years, 111 years, 112 years, 113 years, 114 years, 115 years, 116 years, 117 years, 118 years, 119 years, 120 years, 121 years, 122 years, 123 years, 124 years, 125 years
4                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         TOT, U, G, E, F, Total, Never married, Married/separated, Widowed, Divorced
5                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      2008K1, 2008K2, 2008K3, 2008K4, 2009K1, 2009K2, 2009K3, 2009K4, 2010K1, 2010K2, 2010K3, 2010K4, 2011K1, 2011K2, 2011K3, 2011K4, 2012K1, 2012K2, 2012K3, 2012K4, 2013K1, 2013K2, 2013K3, 2013K4, 2014K1, 2014K2, 2014K3, 2014K4, 2015K1, 2015K2, 2015K3, 2015K4, 2016K1, 2016K2, 2016K3, 2016K4, 2017K1, 2017K2, 2017K3, 2017K4, 2018K1, 2018K2, 2018K3, 2018K4, 2019K1, 2019K2, 2019K3, 2019K4, 2020K1, 2020K2, 2020K3, 2020K4, 2021K1, 2021K2, 2021K3, 2021K4, 2022K1, 2022K2, 2022K3, 2022K4, 2023K1, 2023K2, 2023K3, 2023K4, 2024K1, 2024K2, 2024K3, 2008Q1, 2008Q2, 2008Q3, 2008Q4, 2009Q1, 2009Q2, 2009Q3, 2009Q4, 2010Q1, 2010Q2, 2010Q3, 2010Q4, 2011Q1, 2011Q2, 2011Q3, 2011Q4, 2012Q1, 2012Q2, 2012Q3, 2012Q4, 2013Q1, 2013Q2, 2013Q3, 2013Q4, 2014Q1, 2014Q2, 2014Q3, 2014Q4, 2015Q1, 2015Q2, 2015Q3, 2015Q4, 2016Q1, 2016Q2, 2016Q3, 2016Q4, 2017Q1, 2017Q2, 2017Q3, 2017Q4, 2018Q1, 2018Q2, 2018Q3, 2018Q4, 2019Q1, 2019Q2, 2019Q3, 2019Q4, 2020Q1, 2020Q2, 2020Q3, 2020Q4, 2021Q1, 2021Q2, 2021Q3, 2021Q4, 2022Q1, 2022Q2, 2022Q3, 2022Q4, 2023Q1, 2023Q2, 2023Q3, 2023Q4, 2024Q1, 2024Q2, 2024Q3</code></pre>
</div>
<p>There is a lot of other metadata in the tables, including the phone
number to the staffmember at Statistics Denmark that is responsible for
maintaining the table. We are only interested in the variables, which is
why we add the parameter “variables_only = T”.</p>
<p>What kind of values can the individual datapoints take?</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">metadata</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">slice</span><span class="op">(</span><span class="fl">4</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">pull</span><span class="op">(</span><span class="va">values</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[[1]]
   id              text
1 TOT             Total
2   U     Never married
3   G Married/separated
4   E           Widowed
5   F          Divorced</code></pre>
</div>
<p>We use the slice function from tidyverse to pull out the fourth row
of the dataframe, and the pull-function to pull out the values in the
values column.</p>
<p>The same trick can be done for the other fields in the table:</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">metadata</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">slice</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">pull</span><span class="op">(</span><span class="va">values</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="va">.</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="va">head</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>   id               text
1 000        All Denmark
2 084 Region Hovedstaden
3 101         Copenhagen
4 147      Frederiksberg
5 155             Dragør
6 185             Tårnby</code></pre>
</div>
<p>Here we see the individual municipalities in Denmark.</p>
<p>Now we are almost ready to pull out the actual data!</p>
<p>But first!</p>
</section><section><h2 class="section-heading" id="which-variables-do-we-want">Which variables do we want?<a class="anchor" aria-label="anchor" href="#which-variables-do-we-want"></a>
</h2>
<hr class="half-width">
<p>We need to specify which variables we want in our answer. Do we want
the total population for all municipalities in Denmark? Or just a few?
Do we want the total population, or do we want it broken down by
sex.</p>
<p>These variables, and the values of them, need to be specified when we
pull the data from Statistics Denmark.</p>
<p>We also need to provide that information in a specific way.</p>
<p>If we want data for all municipalites, we want to pull the variable
“OMRÅDE” from the list of variables.</p>
<p>Therefore we need to give the function an argument containing both
the information that we want the population data broken down by
“OMRÅDE”, and that we want all values of “OMRÅDE”.</p>
<p>As before, we need to specify what we want using a list. Let us make
our first list:</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">list</span><span class="op">(</span>code <span class="op">=</span> <span class="st">"OMRÅDE"</span>, values <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>$code
[1] "OMRÅDE"

$values
[1] NA</code></pre>
</div>
<p>This list have to components. One called “code”, and one called
“values”. Code have the content “OMRÅDE”, specifying that we want the
variable in the data from Statistics Denmark calld “OMRÅDE”.</p>
<p>“values” has the content “NA”. We use “NA”, when we want to specify
that we want all the “OMRÅDE”. If we only wanted a specific
municipality, we could instead specify it instead of writing “NA”.</p>
<p>Let us assume that we also want to break down the data based on
marriage status.</p>
<p>That information is stored in the variable “CIVILSTAND”.</p>
<p>And above, we saw that we had the following values in that
variable:</p>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">metadata</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">slice</span><span class="op">(</span><span class="fl">4</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">pull</span><span class="op">(</span><span class="va">values</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[[1]]
   id              text
1 TOT             Total
2   U     Never married
3   G Married/separated
4   E           Widowed
5   F          Divorced</code></pre>
</div>
<p>A value for the total population is probably not that interesting, if
we pull all the individual values for “Never married” etc.</p>
<p>We can now make another list:</p>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="fu">list</span><span class="op">(</span>code <span class="op">=</span> <span class="st">"CIVILSTAND"</span>, values <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="st">"U"</span>, <span class="st">"G"</span>, <span class="st">"E"</span>, <span class="st">"F"</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>$code
[1] "CIVILSTAND"

$values
[1] "U" "G" "E" "F"</code></pre>
</div>
<p>Here the “values” part is a vector containing the values we want to
pull out for that variable.</p>
<p>It might be interesting to take a look at how the population changes
over time.</p>
<p>In that case we need to pull out data from the “Tid” variable.</p>
<p>That would look like this:</p>
<div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">list</span><span class="op">(</span>code <span class="op">=</span> <span class="st">"Tid"</span>, values <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>$code
[1] "Tid"

$values
[1] NA</code></pre>
</div>
<p>If we want to pull data broken down by all three variables, we need
to provide a list, containing three lists.</p>
<p>We do that using this code:</p>
<div class="codewrapper sourceCode" id="cb28">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">variables</span> <span class="op">&lt;-</span> <span class="fu">list</span><span class="op">(</span><span class="fu">list</span><span class="op">(</span>code <span class="op">=</span> <span class="st">"OMRÅDE"</span>, values <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>,</span>
<span>                  <span class="fu">list</span><span class="op">(</span>code <span class="op">=</span> <span class="st">"CIVILSTAND"</span>, values <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="st">"U"</span>, <span class="st">"G"</span>, <span class="st">"E"</span>, <span class="st">"F"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                  <span class="fu">list</span><span class="op">(</span>code <span class="op">=</span> <span class="st">"Tid"</span>, values <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span>
<span>              <span class="op">)</span></span>
<span><span class="va">variables</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[[1]]
[[1]]$code
[1] "OMRÅDE"

[[1]]$values
[1] NA


[[2]]
[[2]]$code
[1] "CIVILSTAND"

[[2]]$values
[1] "U" "G" "E" "F"


[[3]]
[[3]]$code
[1] "Tid"

[[3]]$values
[1] NA</code></pre>
</div>
<p>And now, finally, we are ready to get the data!</p>
<div class="codewrapper sourceCode" id="cb30">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">get_data</span><span class="op">(</span>table_id <span class="op">=</span> <span class="st">"FOLK1A"</span>, variables <span class="op">=</span> <span class="va">variables</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Rows: 28140 Columns: 4
── Column specification ────────────────────────────────────────────────────────
Delimiter: ";"
chr (3): OMRÅDE, CIVILSTAND, TID
dbl (1): INDHOLD

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<p>It takes a short moment. But now we have a dataframe containing the
data we requested:</p>
<div class="codewrapper sourceCode" id="cb32">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">head</span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 6 × 4
  OMRÅDE      CIVILSTAND    TID    INDHOLD
  &lt;chr&gt;       &lt;chr&gt;         &lt;chr&gt;    &lt;dbl&gt;
1 All Denmark Never married 2008Q1 2552700
2 All Denmark Never married 2008Q2 2563134
3 All Denmark Never married 2008Q3 2564705
4 All Denmark Never married 2008Q4 2568255
5 All Denmark Never married 2009Q1 2575185
6 All Denmark Never married 2009Q2 2584993</code></pre>
</div>
<p>This procedure will work for all the tables from Statistics
Denmark!</p>
<p>The data is nicely formatted and ready to use. Almost.</p>
<p>Before we do anything else, let us save the data.</p>
<div class="codewrapper sourceCode" id="cb34">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">write_csv2</span><span class="op">(</span><span class="va">data</span>, <span class="st">"data/SD_data.csv"</span><span class="op">)</span></span></code></pre>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Larger services often provide packages to make it easier to use
their API</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-note-on-time"><p>Content from <a href="note-on-time.html">A short note on time</a></p>
<hr>
<p>Last updated on 2024-08-27 |

        <a href="https://github.com/KUBDatalab/R-api_new/edit/main/episodes/note-on-time.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 12 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can I convert a textual representation of time and dates to
something R can understand?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Learn how to convert text describing dates and time to something R
can understand</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="section level1">
<h1 id="a-relatively-short-session-on-time-">A relatively short session on time.<a class="anchor" aria-label="anchor" href="#a-relatively-short-session-on-time-"></a>
</h1>
<p>“People assume that time is a strict progression from cause to
effect, but actually from a non-linear, non-subjective viewpoint, it’s
more like a big ball of wibbly-wobbly, timey-wimey stuff.”</p>
<p>Time is not easy to deal with. It is actually really complicated. <a href="https://www.youtube.com/watch?v=-5wpm-gesOY" class="external-link">Here is a rant on how
complicated it is…</a></p>
<div class="section level2">
<h2 id="why">Why?<a class="anchor" aria-label="anchor" href="#why"></a>
</h2>
<p>We just pulled data out giving us the danish population, broken down
by marriage status and geographical area. And time.</p>
<p>If the data is not still in memory, we can read it in:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>ℹ Using "','" as decimal and "'.'" as grouping mark. Use `read_delim()` for more control.</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Rows: 28140 Columns: 4
── Column specification ────────────────────────────────────────────────────────
Delimiter: ";"
chr (3): OMRÅDE, CIVILSTAND, TID
dbl (1): INDHOLD

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">read_csv2</span><span class="op">(</span><span class="st">"data/SD_data.csv"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">head</span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 6 × 4
  OMRÅDE      CIVILSTAND    TID    INDHOLD
  &lt;chr&gt;       &lt;chr&gt;         &lt;chr&gt;    &lt;dbl&gt;
1 All Denmark Never married 2008Q1 2552700
2 All Denmark Never married 2008Q2 2563134
3 All Denmark Never married 2008Q3 2564705
4 All Denmark Never married 2008Q4 2568255
5 All Denmark Never married 2009Q1 2575185
6 All Denmark Never married 2009Q2 2584993</code></pre>
</div>
<p>Note that the datatype for “TID” is <em>chr</em>, meaning character.
Those are simply text, not a time. And if we want to plot this, as a
function of time, the “TID” variable needs to be converted into
something R can understand as time.</p>
</div>
<div class="section level2">
<h2 id="a-general-tool">A general tool<a class="anchor" aria-label="anchor" href="#a-general-tool"></a>
</h2>
<p>lubridate is a package written to make working with dates and times
easy(er).</p>
<p>It may need to be installed first.</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">install.packages</span><span class="op">(</span><span class="st">"lubridate"</span><span class="op">)</span></span></code></pre>
</div>
<p>After that, we can load it:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">lubridate</span><span class="op">)</span></span></code></pre>
</div>
<p>Lubridate converts a lot of different ways of writing dates to a
consistent date-time format.</p>
<p>The most important functions we need to know, are:</p>
<ul>
<li>ymd</li>
<li>hms</li>
<li>ymd_hms</li>
</ul>
<p>And variations of these, especially ymd.</p>
<p>ymd(“2021-09-21”) converts the date 2020-09-21 to a date-format that
R can understand:</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ymd</span><span class="op">(</span><span class="st">"2021-09-21"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "2021-09-21"</code></pre>
</div>
<p>Sometimes we have dates formatted as “21-09-2021”. That is day, month
and year in that order.</p>
<p>That can be converted to at standard date-format with the function
dmy():</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">dmy</span><span class="op">(</span><span class="st">"21-09-2021"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "2021-09-21"</code></pre>
</div>
<p>We might even have dates formatted as “2021 21 4”, (year, day month),
the function ydm() can handle that.</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ydm</span><span class="op">(</span><span class="st">"2021 21 4"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "2021-04-21"</code></pre>
</div>
<p>Time is handled in a similar way, but time is usually not written as
creatively as dates:</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">hm</span><span class="op">(</span><span class="st">"14:05"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "14H 5M 0S"</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">hms</span><span class="op">(</span><span class="st">"14.05.21"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "14H 5M 21S"</code></pre>
</div>
<p>Dates and times can be combined, as in: “2021-04-21 14:05:12”:</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ymd_hms</span><span class="op">(</span><span class="st">"2021-04-21 14:05:12"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "2021-04-21 14:05:12 UTC"</code></pre>
</div>
<p>Those were the nice dates…</p>
</div>
<div class="section level2">
<h2 id="not-so-nice-date-formats---a-more-specific-tool">Not so nice date formats - a more specific tool<a class="anchor" aria-label="anchor" href="#not-so-nice-date-formats---a-more-specific-tool"></a>
</h2>
<p>Statistics Denmark returns a lot of data-series by quarter, or month.
And we need to convert it to something we can work with. Without
necessarily understanding all the details.</p>
<p>The library tsibble provides functions that can convert “2020Q1”, the
first quarter of 2020, into something R can understand as
time-value:</p>
<p>We might need to install it first:</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">install.packages</span><span class="op">(</span><span class="st">"tsibble"</span><span class="op">)</span></span></code></pre>
</div>
<p>And then load it:</p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">tsibble</span><span class="op">)</span></span></code></pre>
</div>
<p>This is a vector containg the 8 quarters of the years 2019 and
2020.</p>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">quarters</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">"2019Q1"</span>, <span class="st">"2019Q2"</span>, <span class="st">"2019Q3"</span>, <span class="st">"2019Q4"</span>, <span class="st">"2020Q1"</span>, <span class="st">"2020Q2"</span>, <span class="st">"2020Q3"</span>, <span class="st">"2020Q4"</span><span class="op">)</span></span>
<span><span class="fu">class</span><span class="op">(</span><span class="va">quarters</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "character"</code></pre>
</div>
<p>It is a character vector, ie strings. If we want to analyse any data
associated with these specific quarters, we need to convert them to
something R is able to recognize as time.</p>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">yearquarter</span><span class="op">(</span><span class="va">quarters</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>&lt;yearquarter[8]&gt;
[1] "2019 Q1" "2019 Q2" "2019 Q3" "2019 Q4" "2020 Q1" "2020 Q2" "2020 Q3"
[8] "2020 Q4"
# Year starts on: January</code></pre>
</div>
<p>We are not going to go into further details on the challenges of
working with time-series. The generic lubridate functions and
yearquarter() will be enough for our purposes.</p>
<p>Let us finish by converting the “TID” column in our data, to a
time-format.</p>
<div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>TID <span class="op">=</span> <span class="fu">yearquarter</span><span class="op">(</span><span class="va">TID</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<p>We mutate the column “TID” into the result of running yearquarter()
on the column “TID”. And now we have a data frame that we can do
interesting things with.</p>
<p>Now might be a good time to save the data in its new version:</p>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">write_csv2</span><span class="op">(</span><span class="va">data</span>, <span class="st">"data/SD_data.csv"</span><span class="op">)</span></span></code></pre>
</div>
<p>Note that we are using write_csv2() here. We do not have
decimalpoints in this data, but other data might have.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Working with time and dates can be complicated. Lubridate makes it
easier</li>
<li>Special date-time formats can be handled using the library zoo</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</div>
</div></section><section id="aio-ggplot2"><p>Content from <a href="ggplot2.html">ggplot2</a></p>
<hr>
<p>Last updated on 2024-08-27 |

        <a href="https://github.com/KUBDatalab/R-api_new/edit/main/episodes/ggplot2.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 12 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>What are the components of a ggplot?</li>
<li>How do I create scatterplots, boxplots, and barplots?</li>
<li>How can I change the aesthetics (ex. colour, transparency) of my
plot?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Produce scatter plots, boxplots, and barplots using ggplot.</li>
<li>Set universal plot settings.”</li>
<li>Describe what faceting is and apply faceting in ggplot.</li>
<li>Modify the aesthetics of an existing ggplot plot (including axis
labels and colour).</li>
<li>Build complex and customized plots from data in a data frame.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div id="accordionInstructor1" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor1" aria-expanded="false" aria-controls="collapseInstructor1">
  <h3 class="accordion-header" id="headingInstructor1">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div> Instructor Note </h3>
</button>
<div id="collapseInstructor1" class="accordion-collapse collapse" data-bs-parent="#accordionInstructor1" aria-labelledby="headingInstructor1">
<div class="accordion-body">
<p>Det her - det når vi aldrig.</p>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="nice-data--how-does-it-look">Nice data. How does it look?<a class="anchor" aria-label="anchor" href="#nice-data--how-does-it-look"></a>
</h2>
<hr class="half-width">
<p>R has some nice plotting functions build in.</p>
<p>ggplot2 is a package with more, nicer, plotting possibilities.</p>
<p>We start by loading the required package.
<strong><code>ggplot2</code></strong> is also included in the
<strong><code>tidyverse</code></strong> package.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">tidyverse</span><span class="op">)</span></span></code></pre>
</div>
<p>If not still in the workspace, load the data we saved in the previous
lesson.</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">SD_data</span> <span class="op">&lt;-</span> <span class="fu">read_csv2</span><span class="op">(</span><span class="st">"data/SD_data.csv"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>ℹ Using "','" as decimal and "'.'" as grouping mark. Use `read_delim()` for more control.</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Rows: 28140 Columns: 4
── Column specification ────────────────────────────────────────────────────────
Delimiter: ";"
chr (3): OMRÅDE, CIVILSTAND, TID
dbl (1): INDHOLD

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<p>We read in data from a csv-file. That is stored as text, so we need
to convert the “TID” column to something that can be understood as time
by R:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">SD_data</span> <span class="op">&lt;-</span> <span class="va">SD_data</span> <span class="op">%&gt;%</span> <span class="fu">mutate</span><span class="op">(</span>TID <span class="op">=</span> <span class="fu">yearquarter</span><span class="op">(</span><span class="va">TID</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
</section><section><h2 class="section-heading" id="plotting-with-ggplot2">Plotting with <strong><code>ggplot2</code></strong>
<a class="anchor" aria-label="anchor" href="#plotting-with-ggplot2"></a>
</h2>
<hr class="half-width">
<p><strong><code>ggplot2</code></strong> is a plotting package that
makes it simple to create complex plots from data stored in a data
frame. It provides a programmatic interface for specifying what
variables to plot, how they are displayed, and general visual
properties. Therefore, we only need minimal changes if the underlying
data change or if we decide to change from a bar plot to a scatterplot.
This helps in creating publication quality plots with minimal amounts of
adjustments and tweaking.</p>
<p><strong><code>ggplot2</code></strong> functions work best with data
in the ‘long’ format, i.e., a column for every dimension, and a row for
every observation. Well-structured data will save you lots of time when
making figures with <strong><code>ggplot2</code></strong></p>
<p>ggplot graphics are built step by step by adding new elements. Adding
layers in this fashion allows for extensive flexibility and
customization of plots.</p>
<p>Each chart built with ggplot2 must include the following</p>
<ul>
<li><p>Data<br></p></li>
<li>
<p>Aesthetic mapping (aes)</p>
<ul>
<li>Describes how variables are mapped onto graphical attributes<br>
</li>
<li>Visual attribute of data including x-y axes, color, fill, shape, and
alpha<br>
</li>
</ul>
</li>
<li>
<p>Geometric objects (geom)</p>
<ul>
<li>Determines how values are rendered graphically, as bars
(<code>geom_bar</code>), scatterplot (<code>geom_point</code>), line
(<code>geom_line</code>), etc.</li>
</ul>
</li>
</ul>
<p>Thus, the template for graphic in ggplot2 is:</p>
<pre><code>&lt;DATA&gt; %&gt;%
    ggplot(aes(&lt;MAPPINGS&gt;)) +
    &lt;GEOM_FUNCTION&gt;()</code></pre>
<p>Remember from the last lesson that the pipe operator
<code>%&gt;%</code> places the result of the previous line(s) into the
first argument of the function. <strong><code>ggplot</code></strong> is
a function that expects a data frame to be the first argument. This
allows for us to change from specifying the <code>data =</code> argument
within the <code>ggplot</code> function and instead pipe the data into
the function.</p>
<ul>
<li>use the <code>ggplot()</code> function and bind the plot to a
specific data frame.</li>
</ul>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">SD_data</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<ul>
<li>define a mapping (using the aesthetic (<code>aes</code>) function),
by selecting the variables to be plotted and specifying how to present
them in the graph, e.g. as x/y positions or characteristics such as
size, shape, color, etc.</li>
</ul>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">SD_data</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">TID</span>, y <span class="op">=</span> <span class="va">INDHOLD</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<ul>
<li>
<p>add ‘geoms’ – graphical representations of the data in the plot
(points, lines, bars). <strong><code>ggplot2</code></strong> offers many
different geoms; we will use some common ones today, including:</p>
<ul>
<li>
<code>geom_point()</code> for scatter plots, dot plots, etc.</li>
<li>
<code>geom_boxplot()</code> for, well, boxplots!</li>
<li>
<code>geom_line()</code> for trend lines, time series, etc.</li>
</ul>
</li>
</ul>
<p>To add a geom to the plot use the <code>+</code> operator. Because we
have two continuous variables, let’s use <code>geom_point()</code>
first:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">SD_data</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">TID</span>, y <span class="op">=</span> <span class="va">INDHOLD</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<p><img src="../fig/ggplot2-rendered-first-ggplot-1.png" style="display: block; margin: auto;" class="figure">
What we might note that the fact that we have ALL the municipalites
leads to a LOT of points.</p>
<p>We could have done that when we extracted the data from Statistics
Denmark. Alternatively we can do it now. Let us pull out all the
regions.</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_data</span> <span class="op">&lt;-</span> <span class="va">SD_data</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="fu">str_detect</span><span class="op">(</span><span class="va">OMRÅDE</span>, <span class="st">"Region"</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<p>We use the filter function - we have seen before. And it returns the
rows in the data where the expression we write in the paranthesis is
true.</p>
<p>From the package “stringr”, included in the tidyverse package, we get
the function str_detect().</p>
<p>It detects if the string “Region” is present in the variable OMRÅDE.
If it is, “Region” is detected, the expression is true, and filter()
leaves the row.</p>
<p>Back to <strong><code>ggplot2</code></strong></p>
<p>The <code>+</code> in the <strong><code>ggplot2</code></strong>
package is particularly useful because it allows you to modify existing
<code>ggplot</code> objects. This means you can easily set up plot
templates and conveniently explore different types of plots, so the
above plot can also be generated with code like this, similar to the
“intermediate steps” approach in the previous lesson. We are now
plotting the plot_data dataframe instead:</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Assign plot to a variable</span></span>
<span><span class="va">data_plot</span> <span class="op">&lt;-</span> <span class="va">plot_data</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">TID</span>, y <span class="op">=</span> <span class="va">INDHOLD</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Draw the plot as a dot plot</span></span>
<span><span class="va">data_plot</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<p><img src="../fig/ggplot2-rendered-first-ggplot-with-plus-1.png" style="display: block; margin: auto;" class="figure">
A lot better.</p>
<div id="notes" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="notes" class="callout-inner">
<h3 class="callout-title">Notes</h3>
<div class="callout-content">
<ul>
<li>Anything you put in the <code>ggplot()</code> function can be seen
by any geom layers that you add (i.e., these are universal plot
settings). This includes the x- and y-axis mapping you set up in
<code>aes()</code>.</li>
<li>You can also specify mappings for a given geom independently of the
mapping defined globally in the <code>ggplot()</code> function.</li>
<li>The <code>+</code> sign used to add new layers must be placed at the
end of the line containing the <em>previous</em> layer. If, instead, the
<code>+</code> sign is added at the beginning of the line containing the
new layer, <strong><code>ggplot2</code></strong> will not add the new
layer and will return an error message.</li>
</ul>
</div>
</div>
</div>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## This is the correct syntax for adding layers</span></span>
<span><span class="va">data_plot</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## This will not add the new layer and will return an error message</span></span>
<span><span class="va">data_plot</span></span>
<span><span class="op">+</span> <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
</section><section><h2 class="section-heading" id="building-your-plots-iteratively">Building your plots iteratively<a class="anchor" aria-label="anchor" href="#building-your-plots-iteratively"></a>
</h2>
<hr class="half-width">
<p>Building plots with <strong><code>ggplot2</code></strong> is
typically an iterative process. We start by defining the dataset we’ll
use, lay out the axes, and choose a geom:</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_data</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">TID</span>, y <span class="op">=</span> <span class="va">INDHOLD</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/ggplot2-rendered-create-ggplot-object-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Then, we start modifying this plot to extract more information from
it. We might want to color the points, based on the marriage status.</p>
<p>We place the color argument within the aes() function, because we
want to map the values in “CIVILSTAND” to the</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_data</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">TID</span>, y <span class="op">=</span> <span class="va">INDHOLD</span>, color <span class="op">=</span> <span class="va">CIVILSTAND</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/ggplot2-rendered-adding-colors-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>To colour each marriage status in the plot differently, you could use
a vector as an input to the argument
<strong><code>color</code></strong>. However, because we are now mapping
features of the data to a colour, instead of setting one colour for all
points, the colour of the points now needs to be set inside a call to
the <strong><code>aes</code></strong> function. When we map a variable
in our data to the colour of the points,
<strong><code>ggplot2</code></strong> will provide a different colour
corresponding to the different values of the variable. We will continue
to specify the value of <strong><code>alpha</code></strong>,
<strong><code>width</code></strong>, and
<strong><code>height</code></strong> outside of the
<strong><code>aes</code></strong> function because we are using the same
value for every point. ggplot2 understands both the Commonwealth English
and American English spellings for colour, i.e., you can use either
<code>color</code> or <code>colour</code>. The plot aboge is an example
where we color points by the <strong><code>CIVILSTAND</code></strong> of
the observation.</p>
</section><section><h2 class="section-heading" id="faceting">Faceting<a class="anchor" aria-label="anchor" href="#faceting"></a>
</h2>
<hr class="half-width">
<p>We still have a lot of information Rather than creating a single plot
with points for each region, we may want to create multiple plot, where
each plot shows the data for a single region.</p>
<p><strong><code>ggplot2</code></strong> has a special technique called
<em>faceting</em> that allows the user to split one plot into multiple
plots based on a factor included in the dataset. We will use it to split
our plot of <strong>CIVILSTAND</strong> against time, by
<strong>OMRÅDE</strong>, so each region has its own panel in a
multi-panel plot:</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_data</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">TID</span>, y <span class="op">=</span> <span class="va">INDHOLD</span>, color <span class="op">=</span> <span class="va">CIVILSTAND</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">OMRÅDE</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/ggplot2-rendered-barplot-faceting-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Click the “Zoom” button in your RStudio plots pane to view a larger
version of this plot.</p>
</section><section><h2 class="section-heading" id="boxplot">Boxplot<a class="anchor" aria-label="anchor" href="#boxplot"></a>
</h2>
<hr class="half-width">
<p>We can use boxplots to visualize the distribution of observations for
each <strong>CIVILSTAND</strong>:</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_data</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">CIVILSTAND</span>, y <span class="op">=</span> <span class="va">INDHOLD</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_boxplot</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<p><img src="../fig/ggplot2-rendered-boxplot-1.png" style="display: block; margin: auto;" class="figure">
Let us be frank - a boxplot of these aggregated data is not really that
useful. Boxplots are however so useful, that it is relevant to show how
they are made.</p>
<p>By adding points to a boxplot, we can have a better idea of the
number of measurements and of their distribution:</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_data</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">CIVILSTAND</span>, y <span class="op">=</span> <span class="va">INDHOLD</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_boxplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_jitter</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>        color <span class="op">=</span> <span class="st">"tomato"</span>,</span>
<span>        width <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>        height <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span></span></code></pre>
</div>
<p><img src="../fig/ggplot2-rendered-boxplot-with-jitter-1.png" style="display: block; margin: auto;" class="figure">
Jitter is a special way of plotting points. When we plot the points at
their exact location, we risk that some of the points overlap.
geom_jitter adds a small bit of noise to the data, in order to spread
them out. That way we can better see individual points.</p>
<p>Notice how the boxplot layer is behind the jitter layer? What do you
need to change in the code to put the boxplot in behind the points such
that it’s not hidden?</p>
</section><section><h2 class="section-heading" id="barplots">Barplots<a class="anchor" aria-label="anchor" href="#barplots"></a>
</h2>
<hr class="half-width">
<p>Barplots are also useful for visualizing categorical data. By
default, <code>geom_bar</code> accepts a variable for x, and plots the
number of instances each value of x (in this case, wall type) appears in
the dataset.</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_data</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">CIVILSTAND</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_bar</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/ggplot2-rendered-barplot-1-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>We have an equal number of datapoints for each value of “CIVILSTAND”.
Not that useful.</p>
<p>Rather than using the default “count” of values, we can use the
values directly. In that case, we need to provide both the x- and the
y-values; ggplot does not calculate them!</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_data</span> <span class="op">%&gt;%</span> <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">CIVILSTAND</span>, <span class="va">INDHOLD</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_bar</span><span class="op">(</span>stat<span class="op">=</span><span class="st">"identity"</span><span class="op">)</span></span></code></pre>
</div>
<p><img src="../fig/ggplot2-rendered-barplot-identity-1.png" style="display: block; margin: auto;" class="figure">
Now we get the values from INDHOLD plotted on the y-axis. But we get ALL
the values from INDHOLD plotted. And we have INDHOLD from several years,
from several administrative parts of Denmark.</p>
<p>Let us filter the data.</p>
<p>str_detect(OMRÅDE, “Region”) picks out the rows containing the text
“Region”.</p>
<p>TID == yearquarter(“2008 Q1”) picks out the rows containing data from
the first quarter of 2008. Note that we have to convert “2008 Q1” to the
same datatype as is contained in the columns, using the yearquarter()
function.</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_data</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="fu">str_detect</span><span class="op">(</span><span class="va">OMRÅDE</span>, <span class="st">"Region"</span><span class="op">)</span>,</span>
<span>         <span class="va">TID</span> <span class="op">==</span> <span class="fu">yearquarter</span><span class="op">(</span><span class="st">"2008 Q1"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">CIVILSTAND</span>, <span class="va">INDHOLD</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_bar</span><span class="op">(</span>stat<span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span></span></code></pre>
</div>
<p><img src="../fig/ggplot2-rendered-barplot-quarters-1.png" style="display: block; margin: auto;" class="figure">
Now we get more sensible numbers. But each bar is still the sum of the
number of divorced persons in ALL the regions.</p>
<p>We can color bars by region:</p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_data</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="fu">str_detect</span><span class="op">(</span><span class="va">OMRÅDE</span>, <span class="st">"Region"</span><span class="op">)</span>,</span>
<span>         <span class="va">TID</span> <span class="op">==</span> <span class="fu">yearquarter</span><span class="op">(</span><span class="st">"2008 Q1"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">CIVILSTAND</span>, <span class="va">INDHOLD</span>, color<span class="op">=</span><span class="va">OMRÅDE</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_bar</span><span class="op">(</span>stat<span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span></span></code></pre>
</div>
<p><img src="../fig/ggplot2-rendered-color-by-region-1.png" style="display: block; margin: auto;" class="figure">
Oops! Color only colors the outline of the bars. We can do better.</p>
<p>We can use the <code>fill</code> aesthetic for the
<code>geom_bar()</code> geom to colour bars by the portion of each count
that is from each OMRÅDE.</p>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_data</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="fu">str_detect</span><span class="op">(</span><span class="va">OMRÅDE</span>, <span class="st">"Region"</span><span class="op">)</span>,</span>
<span>         <span class="va">TID</span> <span class="op">==</span> <span class="fu">yearquarter</span><span class="op">(</span><span class="st">"2008 Q1"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">CIVILSTAND</span>, <span class="va">INDHOLD</span>, fill<span class="op">=</span><span class="va">OMRÅDE</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_bar</span><span class="op">(</span>stat<span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/ggplot2-rendered-fill-vs-color-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>This creates a stacked bar chart. These are generally more difficult
to read than side-by-side bars. We can separate the portions of the
stacked bar that correspond to each OMRÅDE and put them side-by-side by
using the <code>position</code> argument for <code>geom_bar()</code> and
setting it to “dodge”.</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_data</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="fu">str_detect</span><span class="op">(</span><span class="va">OMRÅDE</span>, <span class="st">"Region"</span><span class="op">)</span>,</span>
<span>         <span class="va">TID</span> <span class="op">==</span> <span class="fu">yearquarter</span><span class="op">(</span><span class="st">"2008 Q1"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">CIVILSTAND</span>, <span class="va">INDHOLD</span>, fill<span class="op">=</span><span class="va">OMRÅDE</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_bar</span><span class="op">(</span>stat<span class="op">=</span> <span class="st">"identity"</span>, position <span class="op">=</span> <span class="st">"dodge"</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/ggplot2-rendered-dodge-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure></section><section><h2 class="section-heading" id="adding-labels-and-titles">Adding Labels and Titles<a class="anchor" aria-label="anchor" href="#adding-labels-and-titles"></a>
</h2>
<hr class="half-width">
<p>By default, the axes labels on a plot are determined by the name of
the variable being plotted. However,
<strong><code>ggplot2</code></strong> offers lots of customization
options, like specifying the axes labels, and adding a title to the plot
with relatively few lines of code. We will add more informative x-and
y-axis labels to our plot, a more explanatory label to the legend, and a
plot title.</p>
<p>The <code>labs</code> function takes the following arguments:</p>
<ul>
<li>
<code>title</code> – to produce a plot title</li>
<li>
<code>subtitle</code> – to produce a plot subtitle (smaller text
placed beneath the title)</li>
<li>
<code>caption</code> – a caption for the plot</li>
<li>
<code>...</code> – any pair of name and value for aesthetics used in
the plot (e.g., <code>x</code>, <code>y</code>, <code>fill</code>,
<code>color</code>, <code>size</code>)</li>
</ul>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_data</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="fu">str_detect</span><span class="op">(</span><span class="va">OMRÅDE</span>, <span class="st">"Region"</span><span class="op">)</span>,</span>
<span>         <span class="va">TID</span> <span class="op">==</span> <span class="fu">yearquarter</span><span class="op">(</span><span class="st">"2008 Q1"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">CIVILSTAND</span>, <span class="va">INDHOLD</span>, fill<span class="op">=</span><span class="va">OMRÅDE</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_bar</span><span class="op">(</span>stat<span class="op">=</span> <span class="st">"identity"</span>, position <span class="op">=</span> <span class="st">"dodge"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Civilstand by region"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"First quarter of 2008"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Region"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Number"</span>,</span>
<span>       caption <span class="op">=</span> <span class="st">"Pattern appears similar between the regions. Data from Statistics Denmark"</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/ggplot2-rendered-labels-demo-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Usually plots with white background look more readable when printed.
We can set the background to white using the function
<code>theme_bw()</code>. Additionally, you can remove the grid:</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_data</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="fu">str_detect</span><span class="op">(</span><span class="va">OMRÅDE</span>, <span class="st">"Region"</span><span class="op">)</span>,</span>
<span>         <span class="va">TID</span> <span class="op">==</span> <span class="fu">yearquarter</span><span class="op">(</span><span class="st">"2008 Q1"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">CIVILSTAND</span>, <span class="va">INDHOLD</span>, fill<span class="op">=</span><span class="va">OMRÅDE</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_bar</span><span class="op">(</span>stat<span class="op">=</span> <span class="st">"identity"</span>, position <span class="op">=</span> <span class="st">"dodge"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Civilstand by region"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"First quarter of 2008"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Region"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Number"</span>,</span>
<span>       caption <span class="op">=</span> <span class="st">"Pattern appears similar between the regions. Data from Statistics Denmark"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme</span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/ggplot2-rendered-barplot-theme-bw-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>
<code>ggplot2</code> is a flexible and useful tool for creating
plots in R.</li>
<li>The data set and coordinate system can be defined using the
<code>ggplot</code> function.</li>
<li>Additional layers, including geoms, are added using the
<code>+</code> operator.</li>
<li>Boxplots are useful for visualizing the distribution of a continuous
variable.</li>
<li>Barplots are useful for visualizing categorical data.</li>
<li>Faceting allows you to generate multiple plots based on a
categorical variable.</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-whats-next"><p>Content from <a href="whats-next.html">Whats next?</a></p>
<hr>
<p>Last updated on 2024-08-27 |

        <a href="https://github.com/KUBDatalab/R-api_new/edit/main/episodes/whats-next.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 12 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>“What is the next step?”</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>“Get an idea about what to do to learn more”</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>The goal of this course was to give an introduction on how to work
with API in general.</p>
<p>For many of the major services online, there exists specialized
packages making it easier to work with their API.</p>
<p>Ideally we would have a complete list here.</p>
<p>Less ambitiously we would have a solid selection.</p>
<p>For now we have one.</p>
<p>The <a href="https://cran.r-project.org/web/packages/gargle/index.html" class="external-link">gargle
package</a>, provides tools for working with the Google APIs.</p>
<p><a href="https://open-platform.theguardian.com/" class="external-link">The Guardian</a>
have an open API providing access to &gt;2 million articles from that
newspaper. You will need to register for an API key, but it is free.</p>
<p><a href="https://www.wikidata.org/wiki/Wikidata:REST_API" class="external-link">Wikidata</a>
handles factual data for the Wikipedia infrastructure.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>“Practice makes perfect”</li>
<li>“KUB Datalab offers lots of courses and consultations”</li>
<li>“The web is overflowing with tutorials and courses”</li>
</ul>
</div>
</div>
</div></section>
</div>
    </main>
</div>
<!-- END  : inst/pkgdown/templates/content-extra.html -->

      </div>
<!--/div.row-->
      		<footer class="row footer mx-md-3"><hr>
<div class="col-md-6">
        <p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>

        <a href="https://github.com/KUBDatalab/R-api_new/edit/main/README.md" class="external-link">Edit on GitHub</a>

	
        | <a href="https://github.com/KUBDatalab/R-api_new/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://github.com/KUBDatalab/R-api_new/" class="external-link">Source</a></p>
				<p><a href="https://github.com/KUBDatalab/R-api_new/blob/main/CITATION.cff" class="external-link">Cite</a> | <a href="mailto:kubdatalab@kb.dk">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">

        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>

        <p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> by <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.16.6" class="external-link">sandpaper (0.16.6)</a>, <a href="https://github.com/carpentries/pegboard/tree/0.7.6" class="external-link">pegboard (0.7.6)</a>, and <a href="https://github.com/carpentries/varnish/tree/1.0.4" class="external-link">varnish (1.0.4)</a></p>
			</div>
		</footer>
</div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "TrainingMaterial",
  "@id": "https://KUBDatalab.github.io/R-api_new/instructor/aio.html",
  "inLanguage": "en",
  "dct:conformsTo": "https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "software, data, lesson, API, R",
  "name": "All in One View",
  "creativeWorkStatus": "active",
  "url": "https://KUBDatalab.github.io/R-api_new/instructor/aio.html",
  "identifier": "https://KUBDatalab.github.io/R-api_new/instructor/aio.html",
  "dateCreated": "2024-07-29",
  "dateModified": "2024-08-27",
  "datePublished": "2024-08-27"
}

  </script><script>
		feather.replace();
	</script>
</body>
</html><!-- END:   inst/pkgdown/templates/layout.html-->

